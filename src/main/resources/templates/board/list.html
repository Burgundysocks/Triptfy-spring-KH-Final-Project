<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>list</title>
	<link rel="stylesheet" href="/css/layout/fontscroll.css">
	<link rel="stylesheet" href="/css/board/boardlist.css">
</head>

<body>
	<th:block th:include="~{layout/header::header(${session.loginUser})}"></th:block>
    <div class="wrap">
		
        <div class="b_banner">
            <input type="text" placeholder="검색" class="b_search" onkeydown="clickEnter(event)">
            <img src="/images/boardimg/b_search.png" alt="검색아이콘" class="b_searchimg">
			<img src="/images/boardimg/cross.png" alt="" class="search_cancel" style="visibility: hidden;">
            <div class="b_searchDetail" style="display: none;">
                <img src="/images/boardimg/x_icon.png" alt="" class="ximg">
                <div class="recentsearch">
                    <div>최근 검색어</div>
                    <div class="keyword_area">
						<!--<div class="keyword"><span>검색어</span><div class="xbtn"></div></div>-->
                    </div>
                </div>
            </div>
        </div>
        <!-- 정렬 방법 -->
        <div class="post_area">
            <div class="b_buttons">
                <div class="sortbtn">
                    <input type="button" value="최신 순" class="sort selected">
                    <input type="button" value="인기 순" class="sort">
                    <input type="button" value="좋아요 순" class="sort">
                </div>
    
                <div class="nation_area">
                    <button><img src="/images/boardimg/settings.png" alt="설정" class="settings">국가</button>
					<div class="nation_select" style="display: none;">
						<div class="category">
						    <div class="nation">
						        <div>
						            <button class="countrybtn" name="kr"><p class="countrystr">국내</p></button>
						            <button class="countrybtn" name="fr"><p class="countrystr">해외</p></button>
						        </div>
						    </div>
						
						    <div class="c_region">
						        <div style="visibility: hidden;" id="kr">
						            <button class="area" name="서울"><p class="areastr">서울</p></button>
						            <button class="area" name="제주도"><p class="areastr">제주도</p></button>
						            <button class="area" name="경기도"><p class="areastr">경기도</p></button>
						            <button class="area" name="강원도"><p	class="areastr">강원도</p></button>
						            <button	class="area" name="충청도"><p class="areastr">충청도</p></button>
						            <button	class="area" name="경상도"><p class="areastr">경상도</p></button>
						            <button class="area" name="전라도"><p class="areastr">전라도</p></button>
						            <button class="area" name="인천광역시"><p class="areastr">인천광역시</p></button>	
						        </div>
								
								<div style="visibility: hidden;" id="fr">
								    <button class="area" name="동남아시아"><p class="areastr">동남아시아</p></button>
								    <button class="area" name="괌/사이판/호주/뉴질랜드"><p class="areastr">괌/사이판/호주/뉴질랜드</p></button>
								    <button class="area" name="일본"><p class="areastr">일본</p></button>
								    <button class="area" name="중국"><p class="areastr">중국</p></button>
								    <button class="area" name="유럽"><p class="areastr">유럽</p></button>
								    <button class="area" name="미국"><p class="areastr">하와이/미국/중남미</p></button>
								</div>
						    </div>
						    <div class="region_detail">
								<div style="visibility: hidden;" id="ea">
								     <button class="area_detail" name="태국"><p class="area_detailstr">태국</p></button>
								     <button class="area_detail" name="베트남"><p class="area_detailstr">베트남</p></button>
								     <button class="area_detail" name="필리핀"><p class="area_detailstr">필리핀</p></button>
								     <button class="area_detail" name="싱가포르"><p class="area_detailstr">싱가포르</p></button>
								     <button class="area_detail" name="말레이시아"><p class="area_detailstr">말레이시아</p></button>
								     <button class="area_detail" name="캄보디아"><p class="area_detailstr">캄보디아</p></button>
								 </div>
								
								 <div style="visibility: hidden;" id="jp">
								     <button class="area_detail" name="오사카"><p class="area_detailstr">오사카</p></button>
								     <button class="area_detail" name="후쿠오카"><p class="area_detailstr">후쿠오카</p></button>
								     <button class="area_detail" name="도쿄"><p class="area_detailstr">도쿄</p></button>
								     <button class="area_detail" name="교토"><p class="area_detailstr">교토</p></button>
								     <button class="area_detail" name="삿포로"><p class="area_detailstr">삿포로</p></button>
								 </div>
								
								 <div style="visibility: hidden;" id="cn">
								     <button class="area_detail" name="하이난"><p class="area_detailstr">하이난</p></button>
								     <button class="area_detail" name="청도"><p class="area_detailstr">청도</p></button>
								     <button class="area_detail" name="베이징"><p	class="area_detailstr">베이징</p></button>
								     <button class="area_detail" name="장가계"><p class="area_detailstr">장가계</p></button>
								 </div>
								
								 <div style="visibility: hidden;" id="eu">
								     <button class="area_detail" name="프랑스"><p class="area_detailstr">프랑스</p></button>
								     <button class="area_detail" name="영국"><p class="area_detailstr">영국</p></button>
								     <button class="area_detail" name="이탈리아"><p class="area_detailstr">이탈리아</p></button>
								     <button class="area_detail" name="스페인"><p class="area_detailstr">스페인</p></button>
								     <button class="area_detail" name="독일"><p class="area_detailstr">독일</p></button>
								     <button class="area_detail" name="스위스"><p class="area_detailstr">스위스</p></button>
								     <button class="area_detail" name="핀란드"><p class="area_detailstr">핀란드</p></button>
								     <button class="area_detail" name="노르웨이"><p class="area_detailstr">노르웨이</p></button>
								     <button class="area_detail" name="그리스"><p class="area_detailstr">그리스</p></button>
								     <button class="area_detail" name="포르투갈"><p class="area_detailstr">포르투갈</p></button>
								 </div>
								 
								 <div style="visibility: hidden;" id="us">
								     <button class="area_detail" name="하와이"><p class="area_detailstr">하와이</p></button>
								     <button class="area_detail" name="미국(동부)"><p class="area_detailstr">미국(동부)</p></button>
								     <button class="area_detail" name="미국(서부)"><p class="area_detailstr">미국(서부)</p></button>
								     <button class="area_detail" name="캐나다"><p class="area_detailstr">캐나다</p></button>
								     <button class="area_detail" name="중남미"><p class="area_detailstr">중남미</p></button>
								 </div>
							</div>
						</div>
						
						<div class="n_btns">
						    <button onclick="reset();"><img src="/images/boardimg/reset.png" alt=""><span>초기화</span></button>
							<button onclick="regionSearch();">적용</button>
						</div>
                    </div>
                </div>
            </div>

            <!-- 게시글 목록 -->
            <section class="posts">
                <!-- 게시글 -->
                <a th:if="${list != null and list.size > 0}" th:each="board, i:${list}" th:href="@{/board/get(boardnum=${board.boardnum})}">
                    <div class="post">
                        <div class="guide">
                            <img th:src="'/user/thumbnail?sysname=' + ${profiles[i.index].sysname}" alt="">
                            <span>[[${board.userid}]]<img th:if="${guides[i.index]}"  src="/images/userimg/guidebadge.png" alt="" class="guidebadge"></span>
							
							<div class="cnts">
							    <div><img src="/images/boardimg/emptyheart.png" alt="" class="likecntImg"><span>[[${board.likecnt}]]</span></div>
							    <div><img src="/images/boardimg/comments.png" alt=""><span>[[${board.replycnt}]]</span></div>
							    <div><img src="/images/boardimg/viewcnt.png" alt=""><span>[[${board.viewcnt}]]</span></div>
							</div>
                        </div>

                        <div class="p_img">
							<img th:src="'/BoardThumnail/' + ${thumbnails[i.index].sysname}" alt="">
							<!--<img th:src="/images/boardimg/2.jpg" alt="">-->
                        </div>
                        
                        <div class="post_write">
                            <div class="post_title">[[${board.title}]]</div>
                            <div class="post_preview" th:utext="${board.content}"></div>
                        </div>
                    </div>
                </a>
            </section>
			
			<div th:if="${list == null or list.size == 0}" class="no_list">
				<div class="no_post">등록된 게시글이 없습니다.</div>
			</div>
        </div>

        <!-- 페이지 네이션 -->
        <div class="b_pagenation">
            <a class="changePage b_prevbtn" th:id="${pageMaker.cri.pagenum - 1}" th:href="${pageMaker.cri.pagenum - 1}"></a>
			<!--<a class="changePage b_prevbtn" th:id="${pageMaker.startPage - 1}" th:href="${pageMaker.startPage - 1}"></a>-->
            
			<th:block th:each="i : ${#numbers.sequence(pageMaker.startPage, pageMaker.endPage)}">
				<a class="page" th:id="${i}" th:if="${pageMaker.cri.pagenum == i}">[[${i}]]</a>
				<a class="changePage page" th:id="${i}" th:href="${i}" th:unless="${pageMaker.cri.pagenum == i}">[[${i}]]</a>
			</th:block>
			<!--
			<a>1</a>
            <a>2</a>
            <a>3</a>
            <a>4</a>
            <a>5</a>
			-->
            <a class="changePage b_nextbtn" th:id="${pageMaker.cri.pagenum + 1}" th:href="${pageMaker.cri.pagenum + 1}"></a>
        </div>
		<!--
		<div class="writebtn">
		    <input type="button" value="" onclick="boardwrite();">
		</div>
		-->
		<input type="hidden" id="startPage" th:value="${pageMaker.startPage}">
		<input type="hidden" id="realEndPage" th:value="${pageMaker.realEnd}">
		<input type="hidden" id="pagenum" th:value="${pageMaker.cri.pagenum}">
		<input type="hidden" id="keyword" th:value="${pageMaker.cri.keyword}">
		<input type="hidden" id="countrycode" th:value="${pageMaker.cri.countrycode}">
		<input type="hidden" id="regionname" th:value="${pageMaker.cri.regionname}">
		<input type="hidden" id="method" th:value="${sort}">
    </div>
	<th:block th:include="~{layout/alertModal::alertModal}"></th:block>
</body>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script th:inline="javascript">
	const sort = document.getElementsByClassName("sort");  // 최신순, 인기순, 좋아요순 버튼
	const b_search = document.querySelector(".b_search");  // 검색창
	const b_searchDetail = document.querySelector(".b_searchDetail");
	const ximg = document.querySelector(".ximg");
	const search_cancel = document.querySelector(".search_cancel");
	const region_div_kr = document.querySelector(".c_region > div#kr");  // 서울 ~ 인천광역시
	const region_div_fr = document.querySelector(".c_region > div#fr");  // 동남아시아 ~ 하와이/미국...
	const country_select = document.querySelector(".country_select");  // 국내, 해외
	const area_select = document.querySelector(".area_select");  // 서울, 경기도 등 지역
	const area_detail_select = document.querySelector(".area__detail_select");  // 하와이, 미국 등 상세 지역
	
	console.log(country_select)
	console.log(area_select)
	
	
	const startPage = document.getElementById("startPage").value;
	let realEndPage = document.getElementById("realEndPage").value;
	const page = document.getElementById("pagenum").value;
	const keyword = document.getElementById("keyword").value;
	let countrycode = document.getElementById("countrycode").value;
	let regionname = document.getElementById("regionname").value;
	const method = document.getElementById("method").value;
	
	console.log("startPage: " + startPage)
	console.log("realEndPage: " + realEndPage)
	console.log("page: " + page)
	console.log("keyword: " + keyword)
	console.log("countrycode: " + countrycode)
	console.log("regionname: " + regionname)
	console.log("method: " + method)
	
	
	
	if(keyword != "") {
		b_search.value = keyword;
		search_cancel.style.visibility = "visible";
	}
	
	if(countrycode != "") {
		const countrybtn = document.getElementsByClassName("countrybtn");
		const area = document.getElementsByClassName("area");
		
		if(countrycode == "kr") {
			countrybtn[0].style.backgroundColor = "#f0f0f0";
			countrybtn[0].classList.add("country_select");
		}
		
		else if(countrycode == "fr") {
			countrybtn[1].style.backgroundColor = "#f0f0f0";
			countrybtn[1].classList.add("country_select");
		}
		
		else if(countrycode == "ea") {
			countrybtn[1].style.backgroundColor = "#f0f0f0";
			countrybtn[1].classList.add("country_select");
			document.querySelector(".c_region > div#fr").style.visibility = "visible";
			area[8].style.backgroundColor = "#f0f0f0";
			area[8].classList.add("area_select");
		}
		
		else if(countrycode == "gu") {
			countrybtn[1].style.backgroundColor = "#f0f0f0";
			countrybtn[1].classList.add("country_select");
			document.querySelector(".c_region > div#fr").style.visibility = "visible";
			area[9].style.backgroundColor = "#f0f0f0";
			area[9].classList.add("area_select");
		}
		
		else if(countrycode == "jp") {
			countrybtn[1].style.backgroundColor = "#f0f0f0";
			countrybtn[1].classList.add("country_select");
			document.querySelector(".c_region > div#fr").style.visibility = "visible";
			area[10].style.backgroundColor = "#f0f0f0";
			area[10].classList.add("area_select");
		}
		
		else if(countrycode == "cn") {
			countrybtn[1].style.backgroundColor = "#f0f0f0";
			countrybtn[1].classList.add("country_select");
			document.querySelector(".c_region > div#fr").style.visibility = "visible";
			area[11].style.backgroundColor = "#f0f0f0";
			area[11].classList.add("area_select");
		}
		
		else if(countrycode == "eu") {
			countrybtn[1].style.backgroundColor = "#f0f0f0";
			countrybtn[1].classList.add("country_select");
			document.querySelector(".c_region > div#fr").style.visibility = "visible";
			area[12].style.backgroundColor = "#f0f0f0";
			area[12].classList.add("area_select");
		}
		
		else if(countrycode == "us") {
			countrybtn[1].style.backgroundColor = "#f0f0f0";
			countrybtn[1].classList.add("country_select");
			document.querySelector(".c_region > div#fr").style.visibility = "visible";
			area[13].style.backgroundColor = "#f0f0f0";
			area[13].classList.add("area_select");
		}
	}
	
	if(regionname != "") {
		console.log("name: " + regionname)
		const area = document.getElementsByClassName("area");
		const area_detail = document.getElementsByClassName("area_detail");
		console.log("area_detail: " + area_detail[6].name)
		
		if(countrycode == "kr") {
			document.querySelector(".c_region > div#kr").style.visibility = "visible";
			/*
			if(regionname == "서울") {
				area[0].style.backgroundColor = "#f0f0f0";
				area[0].classList.add("area_select");
			}
			
			else if(regionname == "제주도") {
				area[1].style.backgroundColor = "#f0f0f0";
				area[1].classList.add("area_select");
			}
			
			else if(regionname == "경기도") {
				area[2].style.backgroundColor = "#f0f0f0";
				area[2].classList.add("area_select");	
			}
			
			else if(regionname == "강원도") {
				area[3].style.backgroundColor = "#f0f0f0";
				area[3].classList.add("area_select");	
			}
			
			else if(regionname == "충청도") {
				area[4].style.backgroundColor = "#f0f0f0";
				area[4].classList.add("area_select");
			}
			
			else if(regionname == "경상도") {
				area[5].style.backgroundColor = "#f0f0f0";
				area[5].classList.add("area_select");	
			}
			
			else if(regionname == "전라도") {
				area[6].style.backgroundColor = "#f0f0f0";
				area[6].classList.add("area_select");
			}
			
			else if(regionname == "인천광역시") {
				area[7].style.backgroundColor = "#f0f0f0";
				area[7].classList.add("area_select");
			}
			*/
			
			for(let i = 0; i < area.length; i++) {
				if(area[i].name == regionname) {
					area[i].style.backgroundColor = "#f0f0f0";
					area[i].classList.add("area_select");
				}
			}
		
		}
		
		else {
			// document.querySelector(".c_region > div#fr").style.visibility = "visible";
			
			if(regionname == "태국" || regionname == "베트남" || regionname == "필리핀" || regionname == "싱가포르" || regionname == "말레이시아" || regionname == "캄보디아") {
				document.querySelector(".region_detail > div#ea").style.visibility = "visible";
			}
			
			else if(regionname == "오사카" || regionname == "후쿠오카" || regionname == "도쿄" || regionname == "교토" || regionname == "삿포로") {
				document.querySelector(".region_detail > div#jp").style.visibility = "visible";
			}
			
			else if(regionname == "하이난" || regionname == "청도" || regionname == "베이징" || regionname == "장가계") {
				document.querySelector(".region_detail > div#cn").style.visibility = "visible";
			}
			
			else if(regionname == "프랑스" || regionname == "영국" || regionname == "이탈리아" || regionname == "스페인" || regionname == "독일" || regionname == "스위스" || regionname == "핀란드" || regionname == "노르웨이" || regionname == "그리스" || regionname == "포르투갈") {
				document.querySelector(".region_detail > div#eu").style.visibility = "visible";
			}
			
			else if(regionname == "하와이" || regionname == "미국(동부)" || regionname == "미국(서부)" || regionname == "캐나다" || regionname == "중남미") {
				document.querySelector(".region_detail > div#us").style.visibility = "visible";
			}
			
			for(let i = 0; i < area_detail.length; i++) {
				if(area_detail[i].name == regionname) {					
					area_detail[i].style.backgroundColor = "#f0f0f0";
					area_detail[i].classList.add("area_detail_select"); 
				}
			}
			
			/*
			if(regionname == "베트남") {
				document.querySelector(".region_detail > div#ea").style.visibility = "visible";
				area_detail[1].style.backgroundColor = "#f0f0f0";
				area_detail[1].classList.add("area__detail_select");
			}
			*/
			
		}
	
	}
	
	if(method != "") {
		for(let i = 0; i < sort.length; i++) {
			sort[i].classList.remove("selected");  // selected 클래스 모두 제거
			sort[i].style.backgroundColor = "#F5F5F5";
			sort[i].style.color = "#4e4c4c";
		}
		
		if(method == "recent") {
			sort[0].style.backgroundColor = "#000";
			sort[0].style.color = "#fff";
			sort[0].classList.add("selected");
		}
		
		else if(method == "popular") {
			sort[1].style.backgroundColor = "#000";
			sort[1].style.color = "#fff";
			sort[1].classList.add("selected");
		}
		
		else if(method == "like") {
			sort[2].style.backgroundColor = "#000";
			sort[2].style.color = "#fff";
			sort[2].classList.add("selected");
		}
	}
	
	
	
	
		
	// 검색창 focus 되었을 때
	b_search.addEventListener("focus", function() {
		b_searchDetail.style.display = "block";
	});
	
	// 검색창과 최근검색어 창 클릭을 제외하고 다른 곳을 클릭한다면 최근검색어 창이 뜨지 않도록
	// 문서 전체를 클릭했을 때
	document.addEventListener("click", function(e) {
		// 클릭한 부분이 검색창 또는 최근검색어 창인지 확인
	    if (!b_search.contains(event.target) && !b_searchDetail.contains(event.target)) {
			// 클릭한 부분이 검색창 또는 최근검색어 창이 아니라면 display: none;
	        b_searchDetail.style.display = "none";
	    }
	});
	
	// 검색창에 검색어 입력하다가 다 지운 경우
	b_search.addEventListener('input', function() {
	    // 검색창에 입력한게 없다면 입력창에 있는 X 버튼 숨기기
	    if (!b_search.value) {
			search_cancel.style.visibility = 'hidden';
	    } 
		
		else {
			search_cancel.style.visibility = 'visible';
	    }
	});

	// 최근 검색어 창에 있는 X 버튼 클릭했을 때
	ximg.addEventListener("click", function() {
		b_searchDetail.style.display = "none";
		b_search.value = "";
		search_cancel.style.visibility = "hidden";
	});
	
	// 검색어 입력 창에 있는 X 버튼 클릭했을 때
	search_cancel.addEventListener("click", function() {
		console.log(b_search.value)
		b_search.value = "";
		console.log(b_search.value)
		search_cancel.style.visibility = "hidden";
		b_searchDetail.style.display = "none";
	});
	
		
	// 정렬 버튼(최신순, 좋아요순, 인기순) 클릭 시 listsort 함수 호출
	for(let i = 0; i < sort.length; i++) {
		sort[i].addEventListener("click", listsort);
	}
	
	// 정렬 버튼(최신순, 좋아요순, 인기순) 클릭 시 리스트
	function listsort(e) {
		document.querySelector(".nation_select").style.display = "none";
		flag = false;
		console.log(e.target);
		
		for(let i = 0; i < sort.length; i++) {
			sort[i].classList.remove("selected");  // selected 클래스 모두 제거
		}
		
		let obj = e.target;
		let text = obj.value;  // 최신순, 좋아요순, 인기순
		
		obj.classList.add("selected");  // 클릭한 버튼에만 selected 클래스 추가
		
		let keyword = document.querySelector(".b_search").value;
		console.log(keyword);
		
		// keyword = keyword == "" ? null : keyword;
		
		let str = "";
		if(text == "최신 순") {
			str = "recent";
		}
		
		else if(text == "인기 순") {
			str = "popular";
		}
		
		else {
			str = "like";
		}
		console.log(str);
		
		// 국가 코드 및 지역 이름
		const country_select = document.querySelector(".country_select");
		const area_select = document.querySelector(".area_select");
		const area_detail_select = document.querySelector(".area_detail_select");
		
		console.log(country_select)
		console.log(area_select)
				
		let countryName = "";
		let regionName = "";
		if(country_select != null) {
			countryName = country_select.name;
			console.log("countryName: " + countryName)
		}
		
		if(area_select != null) {
			if(area_select.name == "동남아시아") {
				countryName = "ea";
			}
			
			else if(area_select.name == "괌/사이판/호주/뉴질랜드") {
				countryName = "gu";			
			}
			
			else if(area_select.name == "일본") {
				countryName = "jp";								
			}
			
			else if(area_select.name == "중국") {
				countryName = "cn";							
			}
			
			else if(area_select.name == "유럽") {
				countryName = "eu";												
			}
			
			else if(area_select.name == "미국") {
				countryName = "us";								
			}
			
			else {
				regionName = area_select.name;					
			}
			
			console.log("regionName: " + regionName)
		}
		
		if(area_detail_select != null) {
			regionName = area_detail_select.name;		
		}
		
		
		$.ajax({
			url: "/board/sort?sort=" + str + "&keyword=" + keyword + "&countrycode=" + countryName + "&regionname=" + regionName,
			method: "GET",
			
			success:function(data) {
				// console.log("O")
				// console.log(data)
				// console.log(data.sortlist[0].boardnum)
			
				// 정렬 버튼 색 초기화
				for(let i = 0; i < sort.length; i++) {
					sort[i].style.backgroundColor = "#F5F5F5";
					sort[i].style.color = "#4e4c4c";
				}
				
				// 현재 정렬 조건인 버튼 색 변경
				if(data.sortValue == null || data.sortValue == "recent") {
					sort[0].style.backgroundColor = "#000";
					sort[0].style.color = "#fff";
				}
				
				else if(data.sortValue == "popular") {
					sort[1].style.backgroundColor = "#000";
					sort[1].style.color = "#fff";
				}
				
				else if(data.sortValue == "like") {
					sort[2].style.backgroundColor = "#000";
					sort[2].style.color = "#fff";
				}
				
				// DOM 구현
				$(".posts").empty();
				$(".b_pagenation").empty();
				$(".no_list").remove();
				
				if(data.sortlist.length == 0) {
					if($(".no_list").length === 0) {
						let no_list = $("<div>").attr("class", "no_list");
						$(".post_area").append(no_list);
						
						
						$(".no_list").empty();  // 기존에 있던 .no_post 내용 없앰
						let divTag = $("<div>").attr("class", "no_post").text("등록된 게시글이 없습니다.");
						$(".no_list").append(divTag);
						
						// 페이지 네이션
						// 이전 버튼
						let b_prevbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum - 1 + "").addClass("changePage b_prevbtn").attr("id", data.pageMaker.cri.pagenum - 1);
						$(".b_pagenation").append(b_prevbtn);
						
						// 페이지
						let currentPage = $("<a>").text(1).addClass("page").attr("id", 1);
						$(".b_pagenation").append(currentPage);
						
						// 다음 버튼
						let b_nextbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum + 1 + "").addClass("changePage b_nextbtn").attr("id", data.pageMaker.cri.pagenum + 1);							
						$(".b_pagenation").append(b_nextbtn);
						
						realEndPage = data.pageMaker.realEnd;
						console.log("realEndPageTest: " + realEndPage)
					}
				}
				
				else {
					for(let i = 0; i < data.sortlist.length; i++) {
						// .attr: 속성 추가
						// .addClass: 클래스 추가
						let aTag = $("<a>").attr("href", "/board/get?boardnum=" + data.sortlist[i].boardnum);
						let divPost = $("<div>").addClass("post");
							
						let divGuide = $("<div>").addClass("guide");
						let profileImg = data.sortprofiles[i] && data.sortprofiles[i].sysname ? data.sortprofiles[i].sysname : "profile.png";
						let profile = $("<img>").attr("src", "/BoardThumnail/" + profileImg);
						let spanTag = $("<span>").text(data.sortlist[i].userid);
							
						if(data.sortguides[i] != null) {							
							let guideBadge = $("<img>").attr("src", "/images/userimg/guidebadge.png").attr("alt", "").addClass("guidebadge");
							spanTag.append(guideBadge)
						}
						
						divGuide.append(profile, spanTag);
							
						let divCnts = $("<div>").addClass("cnts");
						let likecnt = $("<div>");
						let likecntImg = $("<img>").addClass("likecntImg").attr("src", "/images/boardimg/emptyheart.png");
						let likecntText = $("<span>").text(data.sortlist[i].likecnt);
						likecnt.append(likecntImg, likecntText);
						
						let replycnt = $("<div>");
						let replycntImg = $("<img>").attr("src", "/images/boardimg/comments.png");
						let replycntText = $("<span>").text(data.sortlist[i].replycnt);
						replycnt.append(replycntImg, replycntText);
						
						let viewcnt = $("<div>");
						let viewcntImg = $("<img>").attr("src", "/images/boardimg/viewcnt.png");
						let viewcntText = $("<span>").text(data.sortlist[i].viewcnt);
						viewcnt.append(viewcntImg, viewcntText);
						
						divCnts.append(likecnt, replycnt, viewcnt);
						divGuide.append(divCnts);
							
						let divpImg = $("<div>").addClass("p_img");
						let thumbnail = data.sortthumbnails[i] && data.sortthumbnails[i].sysname ? data.sortthumbnails[i].sysname : "no_img.jpg";
						let boardimg = $("<img>").attr("src", "/BoardThumnail/" + thumbnail).attr("alt", "");
						divpImg.append(boardimg);
						
						
						let divWrite = $("<div>").addClass("post_write");
						let postTitle = $("<div>").addClass("post_title").text(data.sortlist[i].title);
						let postPrev = $("<div>").addClass("post_preview").html(data.sortlist[i].content);
							
						divWrite.append(postTitle, postPrev);
						
						divPost.append(divGuide, divpImg, divWrite);
						aTag.append(divPost);
						
						$(".posts").append(aTag);
					}
					
					// 페이지 네이션
					// 이전 버튼
					let b_prevbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum - 1 + "").addClass("changePage b_prevbtn").attr("id", data.pageMaker.cri.pagenum - 1);
					$(".b_pagenation").append(b_prevbtn);
					
					// 페이지
					for(let i = data.pageMaker.startPage; i <= data.pageMaker.endPage; i++) {							
						if(data.pageMaker.cri.pagenum == i) {
							let currentPage = $("<a>").text(i).addClass("page").attr("id", i);
							$(".b_pagenation").append(currentPage);
						}
						else {								
							let changePage = $("<a>").attr("href", i).addClass("changePage page").text(i).attr("id", i);
							$(".b_pagenation").append(changePage);
						}
					}
					
					// 다음 버튼
					let b_nextbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum + 1 + "").addClass("changePage b_nextbtn").attr("id", data.pageMaker.cri.pagenum + 1);		
					$(".b_pagenation").append(b_nextbtn);
					
					realEndPage = data.pageMaker.realEnd;
					console.log("realEndPageTest: " + realEndPage)
				}
				
				$(".page").each(function() {
				    if ($(this).text().trim() == "1") {
				        $(this).css("color", '#2196F3');
				        $(this).css("border-color", '#2196F3');
				    }
				});
				
			},
			
			error:function() {
				// console.log("X")
				showAlertModal(1,"잠시 후에 다시 시도해주세요");
			}
			
		})
		
	}
	
	function clickEnter(e) {
		if(e.keyCode == 13) {  // 엔터 키 클릭 시
			search(e.target.value);
			b_searchDetail.style.display = "none";
		}
	}
	
	function search(keyword) {
		document.querySelector(".nation_select").style.display = "none";
		flag = false;
		
		
		if(keyword == "") {
			showAlertModal(2,"검색어를 입력해주세요");
			e.target.focus();
		}
		
		let sort = document.querySelector(".selected").value;
		console.log(sort);
		
		let str = "";
		if(sort == "최신 순") {
			str = "recent";
		}
		
		else if(sort == "인기 순") {
			str = "popular";
		}
		
		else {
			str = "like";
		}
		console.log(str);
		
		// 국가 코드 및 지역 이름
		const country_select = document.querySelector(".country_select");
		const area_select = document.querySelector(".area_select");
		const area_detail_select = document.querySelector(".area_detail_select");
		
		console.log(country_select)
		console.log(area_select)
				
		let countryName = "";
		let regionName = "";
		if(country_select != null) {
			countryName = country_select.name;
			console.log("countryName: " + countryName)
		}
		
		if(area_select != null) {
			if(area_select.name == "동남아시아") {
				countryName = "ea";
			}
			
			else if(area_select.name == "괌/사이판/호주/뉴질랜드") {
				countryName = "gu";			
			}
			
			else if(area_select.name == "일본") {
				countryName = "jp";								
			}
			
			else if(area_select.name == "중국") {
				countryName = "cn";							
			}
			
			else if(area_select.name == "유럽") {
				countryName = "eu";												
			}
			
			else if(area_select.name == "미국") {
				countryName = "us";								
			}
			
			else {
				regionName = area_select.name;					
			}
			
			console.log("regionName: " + regionName)
		}
		
		if(area_detail_select != null) {
			regionName = area_detail_select.name;		
		}
		
		$.ajax({
			url: "/board/sort?sort=" + str + "&keyword=" + keyword + "&countrycode=" + countryName + "&regionname=" + regionName,		
			method: "GET",
			
			success:function(data) {
				// console.log("O")
				// console.log(result)
				// console.log(result.searchList.length)
				
				// DOM 구현
				$(".posts").empty();
				$(".b_pagenation").empty();
				$(".no_list").remove();
				
				if(data.sortlist.length == 0) {
					if($(".no_list").length === 0) {
						let no_list = $("<div>").attr("class", "no_list");
						$(".post_area").append(no_list);
						
						
						$(".no_list").empty();  // 기존에 있던 .no_post 내용 없앰
						let divTag = $("<div>").attr("class", "no_post").text("등록된 게시글이 없습니다.");
						$(".no_list").append(divTag);
						
						// 페이지 네이션
						// 이전 버튼
						let b_prevbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum - 1 + "").addClass("changePage b_prevbtn").attr("id", data.pageMaker.cri.pagenum - 1);
						$(".b_pagenation").append(b_prevbtn);
						
						// 페이지
						let currentPage = $("<a>").text(1).addClass("page").attr("id", 1);
						$(".b_pagenation").append(currentPage);
						
						// 다음 버튼
						let b_nextbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum + 1 + "").addClass("changePage b_nextbtn").attr("id", data.pageMaker.cri.pagenum + 1);		
						$(".b_pagenation").append(b_nextbtn);
						
						realEndPage = data.pageMaker.realEnd;
						console.log("realEndPageTest: " + realEndPage)
					}
				}
				
				else {
					$(".no_list").remove();
					
					for(let i = 0; i < data.sortlist.length; i++) {
						// .attr: 속성 추가
						// .addClass: 클래스 추가
						let aTag = $("<a>").attr("href", "/board/get?boardnum=" + data.sortlist[i].boardnum);
						let divPost = $("<div>").addClass("post");
							
						let divGuide = $("<div>").addClass("guide");
						let profileImg = data.sortprofiles[i] && data.sortprofiles[i].sysname ? data.sortprofiles[i].sysname : "profile.png";
						let profile = $("<img>").attr("src", "/BoardThumnail/" + profileImg);
						let spanTag = $("<span>").text(data.sortlist[i].userid);
							
						if(data.sortguides[i] != null) {							
							let guideBadge = $("<img>").attr("src", "/images/userimg/guidebadge.png").attr("alt", "").addClass("guidebadge");
							spanTag.append(guideBadge)
						}
						
						divGuide.append(profile, spanTag);
							
						let divCnts = $("<div>").addClass("cnts");
						let likecnt = $("<div>");
						let likecntImg = $("<img>").addClass("likecntImg").attr("src", "/images/boardimg/emptyheart.png");
						let likecntText = $("<span>").text(data.sortlist[i].likecnt);
						likecnt.append(likecntImg, likecntText);
						
						let replycnt = $("<div>");
						let replycntImg = $("<img>").attr("src", "/images/boardimg/comments.png");
						let replycntText = $("<span>").text(data.sortlist[i].replycnt);
						replycnt.append(replycntImg, replycntText);
						
						let viewcnt = $("<div>");
						let viewcntImg = $("<img>").attr("src", "/images/boardimg/viewcnt.png");
						let viewcntText = $("<span>").text(data.sortlist[i].viewcnt);
						viewcnt.append(viewcntImg, viewcntText);
						
						divCnts.append(likecnt, replycnt, viewcnt);
						divGuide.append(divCnts);
							
						let divpImg = $("<div>").addClass("p_img");
						let thumbnail = data.sortthumbnails[i] && data.sortthumbnails[i].sysname ? data.sortthumbnails[i].sysname : "no_img.jpg";
						let boardimg = $("<img>").attr("src", "/BoardThumnail/" + thumbnail).attr("alt", "");
						divpImg.append(boardimg);
						
						
						let divWrite = $("<div>").addClass("post_write");
						let postTitle = $("<div>").addClass("post_title").text(data.sortlist[i].title);
						let postPrev = $("<div>").addClass("post_preview").html(data.sortlist[i].content);
							
						divWrite.append(postTitle, postPrev);
						
						divPost.append(divGuide, divpImg, divWrite);
						aTag.append(divPost);
						
						$(".posts").append(aTag);
					}
					
					// 페이지 네이션
					// 이전 버튼
					let b_prevbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum - 1 + "").addClass("changePage b_prevbtn").attr("id", data.pageMaker.cri.pagenum - 1);
					$(".b_pagenation").append(b_prevbtn);
					
					// 페이지
					for(let i = data.pageMaker.startPage; i <= data.pageMaker.endPage; i++) {							
						if(data.pageMaker.cri.pagenum == i) {
							let currentPage = $("<a>").text(i).addClass("page").attr("id", i);
							$(".b_pagenation").append(currentPage);
						}
						else {								
							let changePage = $("<a>").attr("href", i).addClass("changePage page").text(i).attr("id", i);
							$(".b_pagenation").append(changePage);
						}
					}
					
					// 다음 버튼
					let b_nextbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum + 1 + "").addClass("changePage b_nextbtn").attr("id", data.pageMaker.cri.pagenum + 1);		
					$(".b_pagenation").append(b_nextbtn);
					
					realEndPage = data.pageMaker.realEnd;
					console.log("realEndPageTest: " + realEndPage)	
				}
				
				$(".page").each(function() {
				    if ($(this).text().trim() == "1") {
				        $(this).css("color", '#2196F3');
				        $(this).css("border-color", '#2196F3');
				    }
				});
				
				recentKeyword();
			},
			
			error:function(data) {
				// console.log("X")
				showAlertModal(1, "잠시 후에 다시 시도해주세요");
			}
		})
	}
	
	// 국가 버튼 클릭 시 카테고리 선택 창
	const nationBtn = document.querySelector(".nation_area > button");
	const nation_select = document.querySelector(".nation_select");
	// console.log(nationBtn)
	nationBtn.addEventListener("click", nation);
	
	let flag = false;
	function nation() {
		if(!flag) {
			flag = true;
			nation_select.style.display = "flex";
		}
		
		else {
			nation_select.style.display = "none";
			flag = false;
			
		}
	}
	
	const countrybtn = document.getElementsByClassName("countrybtn");
	const countrystr = document.getElementsByClassName("countrystr");
	
	const area = document.getElementsByClassName("area");
	const areastr = document.getElementsByClassName("areastr");
	
	const area_detail = document.getElementsByClassName("area_detail");
	const area_detailstr = document.getElementsByClassName("area_detailstr");
	
	for(let i = 0; i < countrystr.length; i++) {
		countrystr[i].addEventListener("click", function(e) {
			// p태그 클릭 시 이벤트 막고 그 부모 요소가 클릭되도록
			e.stopPropagation();  // 이벤트 막음
			this.parentElement.click();  // 부모 요소(button 태그 클릭)
		})
	}
	
	for(let i = 0; i < countrybtn.length; i++) {
		countrybtn[i].addEventListener("click", countryClick);
	}
	
	function countryClick(e) {
		// 국내, 해외 버튼 색 초기화
		for(let i = 0; i < countrybtn.length; i++) {
			countrybtn[i].style.backgroundColor = "#fff";
			countrybtn[i].classList.remove("country_select");
		}
		
		let obj = e.target;
		obj.style.backgroundColor = "#f0f0f0";
		console.log(obj.textContent)  // obj.textContent: obj의 모든 텍스트(자식 요소의 텍스트 포함)
		
		const region_div_kr = document.querySelector(".c_region > div#kr");
		const region_div_fr = document.querySelector(".c_region > div#fr");
		const region_detail_div = document.querySelectorAll(".region_detail div");
		
		if(obj.textContent == "국내") {
			region_div_kr.style.visibility = "visible";
			region_div_fr.style.visibility = "hidden";
			
			for(let i = 0; i < region_detail_div.length; i++) {
				region_detail_div[i].style.visibility = "hidden";
			}
			
		}
		
		else if(obj.textContent == "해외") {
			region_div_kr.style.visibility = "hidden";
			region_div_fr.style.visibility = "visible";
			
			if(area_select != null) {			
				for(let i = 0; i < area_select.length; i++) {
					area_select[i].classList.remove("area_select");
				}
			}
			
		}
		
		// 지역 버튼 색상 및 클래스 초기화
		for(let i = 0; i < area.length; i++) {
			area[i].style.backgroundColor = "#fff";
			area[i].classList.remove("area_select");
		}
		
		// 상세지역 버튼 색상 및 클래스 초기화
		for(let i = 0; i < area_detail.length; i++) {
			area_detail[i].style.backgroundColor = "#fff";
			area_detail[i].classList.remove("area_detail_select");
		}
		
		obj.classList.add("country_select");
	}
	
	
	for(let i = 0; i < areastr.length; i++) {
		areastr[i].addEventListener("click", function(e) {
			// p태그 클릭 시 이벤트 막고 그 부모 요소가 클릭되도록
			e.stopPropagation();  // 이벤트 막음
			this.parentElement.click();  // 부모 요소(button 태그 클릭)
		});
	}
	
	for(let i = 0; i < area.length; i++) {
		area[i].addEventListener("click", areaClick);
	}
	
	function areaClick(e) {
		let obj = e.target;
		console.log("------------------")
		console.log(e.target.name)
		
		// 지역 버튼 색상 초기화
		for(let i = 0; i < area.length; i++) {
			area[i].style.backgroundColor = "#fff";
			area[i].classList.remove("area_select");
		}
		
		obj.style.backgroundColor = "#f0f0f0";
		obj.classList.add("area_select");
		
		const ea = document.getElementById("ea");
		const jp = document.getElementById("jp");
		const cn = document.getElementById("cn");
		const eu = document.getElementById("eu");
		const us = document.getElementById("us");
		
		let txt = e.target.name;
		
		if(txt == "동남아시아") {
			ea.style.visibility = "visible";
			jp.style.visibility = "hidden";
			cn.style.visibility = "hidden";
			eu.style.visibility = "hidden";
			us.style.visibility = "hidden";
		}
		
		else if(txt == "괌/사이판/호주/뉴질랜드") {
			ea.style.visibility = "hidden";
			jp.style.visibility = "hidden";
			cn.style.visibility = "hidden";
			eu.style.visibility = "hidden";
			us.style.visibility = "hidden";
		}
		
		else if(txt == "일본") {
			jp.style.visibility = "visible"; 
			ea.style.visibility = "hidden";
			cn.style.visibility = "hidden";
			eu.style.visibility = "hidden";
			us.style.visibility = "hidden";
		}
		
		else if(txt == "중국") { 
			cn.style.visibility = "visible";
			ea.style.visibility = "hidden";
			jp.style.visibility = "hidden";
			eu.style.visibility = "hidden";
			us.style.visibility = "hidden";
		}
		
		else if(txt == "유럽") { 
			eu.style.visibility = "visible";
			ea.style.visibility = "hidden";
			jp.style.visibility = "hidden";
			cn.style.visibility = "hidden";
			us.style.visibility = "hidden";
		}
		
		else if(txt == "미국") { 
			us.style.visibility = "visible";
			ea.style.visibility = "hidden";
			jp.style.visibility = "hidden";
			cn.style.visibility = "hidden";
			eu.style.visibility = "hidden";
		}

	}
	
	
	
	for(let i = 0; i < area_detailstr.length; i++) {
		area_detailstr[i].addEventListener("click", function(e) {
			// p태그 클릭 시 이벤트 막고 그 부모 요소가 클릭되도록
			e.stopPropagation();  // 이벤트 막음
			this.parentElement.click();  // 부모 요소(button 태그 클릭)
		});
	}
	
	for(let i = 0; i < area_detail.length; i++) {
		area_detail[i].addEventListener("click", areadetailClick);
	}
	
	function areadetailClick(e) {
		let obj = e.target;
		
		// 지역 버튼 색상 초기화
		for(let i = 0; i < area_detail.length; i++) {
			area_detail[i].style.backgroundColor = "#fff";
			area_detail[i].classList.remove("area_detail_select");
		}
		
		obj.style.backgroundColor = "#f0f0f0";
		obj.classList.add("area_detail_select");
	}
	
	function regionSearch() {
		const country = document.querySelector(".country_select");
		const region = document.querySelector(".area_select");
		const region_detail = document.querySelector(".area_detail_select");
		
		
		// 국내, 해외 선택하지 않은 경우
		if(country == null) {
			showAlertModal(2, "나라를 선택해주세요");
		}
		
		// 국내, 해외 선택
		else {
			let regionName = "";
			
			let countryName = country.name;
			console.log("countryName: " + countryName);
			
			if(country.name == "kr") {
				// 지역 선택
				if(region != null) {
					regionName = region.name;
				}
				console.log("regionName: " + regionName);
			}
			
			else if(country.name == "fr") {
				// 지역 선택
				if(region != null) {
					let txt = region.name;
					console.log("countryName2: " + txt);
					
					if(txt == "동남아시아") { 
						countryName = "ea"; 
					}
					
					else if(txt == "괌/사이판/호주/뉴질랜드") {
						countryName = "gu"; 
					}
					
					else if(txt == "일본") {
						countryName = "jp";
					}
					
					else if(txt == "중국") { 
						countryName = "cn";	
					}
					
					else if(txt == "유럽") { 
						countryName = "eu"; 
					}
					
					else if(txt == "미국") { 
						countryName = "us"; 
					}
					
					
					if(region_detail != null) {
						console.log("name: " + region_detail.name);
						regionName = region_detail.name;
					}
				}
			}
			
			
			nation_select.style.display = "none";
			flag = false;
			
			
			let sort = document.querySelector(".selected").value;
			console.log(sort);
			
			let str = "";
			if(sort == "최신 순") {
				str = "recent";
			}
			
			else if(sort == "인기 순") {
				str = "popular";
			}
			
			else {
				str = "like";
			}
			console.log(str);
			
			let keyword = document.querySelector(".b_search").value;
			console.log(keyword);
			
			$.ajax({
				url: "/board/sort?sort=" + str + "&keyword=" + keyword + "&countrycode=" + countryName + "&regionname=" + regionName,
				method: "GET",
				
				success:function(data) {
					//console.log("O")
					
					// DOM 구현
					$(".posts").empty();
					$(".b_pagenation").empty();
					$(".no_list").remove();
					
					if(data.sortlist.length == 0) {
						if($(".no_list").length === 0) {
							let no_list = $("<div>").attr("class", "no_list");
							$(".post_area").append(no_list);
							
							
							$(".no_list").empty();  // 기존에 있던 .no_post 내용 없앰
							let divTag = $("<div>").attr("class", "no_post").text("등록된 게시글이 없습니다.");
							$(".no_list").append(divTag);
							
							// 페이지 네이션
							// 이전 버튼
							let b_prevbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum - 1 + "").addClass("changePage b_prevbtn").attr("id", data.pageMaker.cri.pagenum - 1);
							$(".b_pagenation").append(b_prevbtn);
							
							// 페이지
							let currentPage = $("<a>").text(1).addClass("page").attr("id", 1);
							$(".b_pagenation").append(currentPage);
							
							// 다음 버튼
							let b_nextbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum + 1 + "").addClass("changePage b_nextbtn").attr("id", data.pageMaker.cri.pagenum + 1);		
							$(".b_pagenation").append(b_nextbtn);
							
							realEndPage = data.pageMaker.realEnd;
							console.log("realEndPageTest: " + realEndPage)
						}
					}
					
					else {
						$(".no_list").remove();
						
						for(let i = 0; i < data.sortlist.length; i++) {
							// .attr: 속성 추가
							// .addClass: 클래스 추가
							let aTag = $("<a>").attr("href", "/board/get?boardnum=" + data.sortlist[i].boardnum);
							let divPost = $("<div>").addClass("post");
								
							let divGuide = $("<div>").addClass("guide");
							let profileImg = data.sortprofiles[i] && data.sortprofiles[i].sysname ? data.sortprofiles[i].sysname : "profile.png";
							let profile = $("<img>").attr("src", "/BoardThumnail/" + profileImg);
							let spanTag = $("<span>").text(data.sortlist[i].userid);
								
							if(data.sortguides[i] != null) {							
								let guideBadge = $("<img>").attr("src", "/images/userimg/guidebadge.png").attr("alt", "").addClass("guidebadge");
								spanTag.append(guideBadge)
							}
							
							divGuide.append(profile, spanTag);
								
							let divCnts = $("<div>").addClass("cnts");
							let likecnt = $("<div>");
							let likecntImg = $("<img>").addClass("likecntImg").attr("src", "/images/boardimg/emptyheart.png");
							let likecntText = $("<span>").text(data.sortlist[i].likecnt);
							likecnt.append(likecntImg, likecntText);
							
							let replycnt = $("<div>");
							let replycntImg = $("<img>").attr("src", "/images/boardimg/comments.png");
							let replycntText = $("<span>").text(data.sortlist[i].replycnt);
							replycnt.append(replycntImg, replycntText);
							
							let viewcnt = $("<div>");
							let viewcntImg = $("<img>").attr("src", "/images/boardimg/viewcnt.png");
							let viewcntText = $("<span>").text(data.sortlist[i].viewcnt);
							viewcnt.append(viewcntImg, viewcntText);
							
							divCnts.append(likecnt, replycnt, viewcnt);
							divGuide.append(divCnts);
								
							let divpImg = $("<div>").addClass("p_img");
							let thumbnail = data.sortthumbnails[i] && data.sortthumbnails[i].sysname ? data.sortthumbnails[i].sysname : "no_img.jpg";
							let boardimg = $("<img>").attr("src", "/BoardThumnail/" + thumbnail).attr("alt", "");
							divpImg.append(boardimg);
							
							
							let divWrite = $("<div>").addClass("post_write");
							let postTitle = $("<div>").addClass("post_title").text(data.sortlist[i].title);
							let postPrev = $("<div>").addClass("post_preview").html(data.sortlist[i].content);
								
							divWrite.append(postTitle, postPrev);
							
							divPost.append(divGuide, divpImg, divWrite);
							aTag.append(divPost);
							
							$(".posts").append(aTag);
						}
						
						// 페이지 네이션
						// 이전 버튼
						let b_prevbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum - 1 + "").addClass("changePage b_prevbtn").attr("id", data.pageMaker.cri.pagenum - 1);
						$(".b_pagenation").append(b_prevbtn);
						
						// 페이지
						for(let i = data.pageMaker.startPage; i <= data.pageMaker.endPage; i++) {							
							if(data.pageMaker.cri.pagenum == i) {
								let currentPage = $("<a>").text(i).addClass("page").attr("id", i);
								$(".b_pagenation").append(currentPage);
							}
							else {								
								let changePage = $("<a>").attr("href", i).addClass("changePage page").text(i).attr("id", i);
								$(".b_pagenation").append(changePage);
							}
						}
						
						// 다음 버튼
						let b_nextbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum + 1 + "").addClass("changePage b_nextbtn").attr("id", data.pageMaker.cri.pagenum + 1);		
						$(".b_pagenation").append(b_nextbtn);
						
						realEndPage = data.pageMaker.realEnd;
						console.log("realEndPageTest: " + realEndPage)
						
					}
					
					$(".page").each(function() {
					    if ($(this).text().trim() == "1") {
					        $(this).css("color", '#2196F3');
					        $(this).css("border-color", '#2196F3');
					    }
					});
				},
				
				error:function(data) {
					// console.log("X")
					showAlertModal(1, "잠시 후에 다시 시도해주세요");
				}
			})
		}
	}
	
	
	function reset() {
		// 국내, 해외 버튼 색 초기화
		for(let i = 0; i < countrybtn.length; i++) {
			countrybtn[i].style.backgroundColor = "#fff";
		}
		
		// 지역 버튼 색 초기화
		for(let i = 0; i < area.length; i++) {
			area[i].style.backgroundColor = "#fff";
		}
		
		const country_select = document.querySelector(".country_select");
		const area_select = document.querySelector(".area_select");
		const area_detail_select = document.querySelector(".area_detail_select");
		
		const region_detail_div = document.querySelectorAll(".region_detail div");
		
		if(country_select != null) {			
			country_select.classList.remove("country_select");
		}
		
		if(area_select != null) {			
			area_select.classList.remove("area_select");
		}
		
		if(area_detail_select != null) {
			area_detail_select.classList.remove("area_detail_select");
		}
		
		//nation_select.style.display = "none";
		//flag = false;
		region_div_kr.style.visibility = "hidden";
		region_div_fr.style.visibility = "hidden";
		
		for(let i = 0; i < region_detail_div.length; i++) {
			region_detail_div[i].style.visibility = "hidden";
		}
	}
	
	// 페이징 처리 부분의 이전 버튼과 다음 버튼, 이동할 페이지 번호 버튼 클릭 시 이벤트 막음
	$(document).ready(function() {
	    $(document).on('click', '.changePage', function(e) {
	        e.preventDefault(); // 이벤트 막음
			pageChange(e);
	    });
		
		$(".page").each(function() {
			if($(this).text().trim() == page) {
				$(this).css("color", '#2196F3');
				$(this).css("border-color", '#2196F3');
			}
		});
		/*
		$(".likecntImg").on("click", function(e) {
		    console.log("e.target: " + e.target)
		    e.stopPropagation(); // 이벤트 전파 막음
		    
		    // 클릭된 요소가 <a> 태그의 하위 요소인지 확인
		    if ($(this).closest("a").length > 0) {
		        e.preventDefault(); // 링크 이동을 막음
				
				like(e);
		    }
		});
		*/
		
		// 최근 검색어 삭제
		$(document).on("click", ".xbtn", function(e) {
			e.stopPropagation();  // 이벤트 전파 막음(부모 요소인 .keyword가 클릭된 것으로 인식되지 않게)
		     // console.log("e.target: " + e.target);
			 let keywordTxt = $(this).closest(".keyword").find("span").text().trim();  // .keyword의 span 태그의 text
			 
			 // 클릭된 xbtn의 부모 요소 중에서 .keyword 클래스를 가진 요소를 찾아 삭제
			 $(this).closest(".keyword").remove();
			 
			 let keywords = getCookie("keywords");
			 if(keywords) {
				let keywordsArray = keywords.split("_-_");  // _-_ 기준으로 자름
				
				let updatedKeywords = keywordsArray.filter(function(keyword) {
				    return keyword !== keywordTxt;
				});
				document.cookie = "keywords=" + updatedKeywords.join("_-_");
			 }
		 });
		 
		 $(document).on("click", ".keyword", function(e) {
			let keywordDivTag = $(this);  // 현재 클릭된 .keyword
			let keyword = keywordDivTag.find('span').text();  // 
			console.log("-----------------------keyword: " + keyword)
			$(".b_searchDetail").hide();
			$(".b_search").val(keyword);
			search(keyword);
		 })
		 
		
	});
	
	function pageChange(e) {
		console.log(e.target)
		console.log(e.target.id)
		// e.currentTarget
		
		// 이동할 페이지 번호
		let pagenum = e.target.id;
		// b_prev <= 0 || b_next > realEndPage
		console.log("realEnd: " + realEndPage)
		
		const prev = document.querySelector(".b_prevbtn");
		const next =document.querySelector(".b_nextbtn");
		
		if(e.target.classList.contains('b_prevbtn')) {
			if(pagenum <= 0) {
				showAlertModal(2, "첫번째 페이지입니다");
			}
			
			else {
				// 정렬 방법
				let sort = document.querySelector(".selected").value;
				console.log(sort);
				
				let str = "";
				if(sort == "최신 순") {
					str = "recent";
				}
				
				else if(sort == "인기 순") {
					str = "popular";
				}
				
				else {
					str = "like";
				}
				console.log(str);
				
				// 키워드
				let keyword = document.querySelector(".b_search").value;
				console.log(keyword);
				
				// 국가 코드 및 지역 이름
				const country_select = document.querySelector(".country_select");
				const area_select = document.querySelector(".area_select");
				const area_detail_select = document.querySelector(".area_detail_select");
				
				console.log(country_select)
				console.log(area_select)
						
				let countryName = "";
				let regionName = "";
				if(country_select != null) {
					countryName = country_select.name;
					console.log("countryName: " + countryName)
				}
				
				if(area_select != null) {
					if(area_select.name == "동남아시아") {
						countryName = "ea";
					}
					
					else if(area_select.name == "괌/사이판/호주/뉴질랜드") {
						countryName = "gu";			
					}
					
					else if(area_select.name == "일본") {
						countryName = "jp";								
					}
					
					else if(area_select.name == "중국") {
						countryName = "cn";							
					}
					
					else if(area_select.name == "유럽") {
						countryName = "eu";												
					}
					
					else if(area_select.name == "미국") {
						countryName = "us";								
					}
					
					else {
						regionName = area_select.name;					
					}
					
					console.log("regionName: " + regionName)
				}
				
				if(area_detail_select != null) {
					regionName = area_detail_select.name;		
				}
				
				location.replace("/board/list?sort=" + str + "&keyword=" + keyword + "&countrycode=" + countryName + "&regionname=" + regionName + "&pagenum=" + pagenum);
			}
		}
		
		else if(e.target.classList.contains('b_nextbtn')) {
			if(parseInt(pagenum) > parseInt(realEndPage)) {
				showAlertModal(2, "마지막 페이지입니다");
			}
			
			else {
				// 정렬 방법
				let sort = document.querySelector(".selected").value;
				console.log(sort);
				
				let str = "";
				if(sort == "최신 순") {
					str = "recent";
				}
				
				else if(sort == "인기 순") {
					str = "popular";
				}
				
				else {
					str = "like";
				}
				console.log(str);
				
				// 키워드
				let keyword = document.querySelector(".b_search").value;
				console.log(keyword);
				
				// 국가 코드 및 지역 이름
				const country_select = document.querySelector(".country_select");
				const area_select = document.querySelector(".area_select");
				const area_detail_select = document.querySelector(".area_detail_select");
				
				console.log(country_select)
				console.log(area_select)
						
				let countryName = "";
				let regionName = "";
				if(country_select != null) {
					countryName = country_select.name;
					console.log("countryName: " + countryName)
				}
				
				if(area_select != null) {
					if(area_select.name == "동남아시아") {
						countryName = "ea";
					}
					
					else if(area_select.name == "괌/사이판/호주/뉴질랜드") {
						countryName = "gu";			
					}
					
					else if(area_select.name == "일본") {
						countryName = "jp";								
					}
					
					else if(area_select.name == "중국") {
						countryName = "cn";							
					}
					
					else if(area_select.name == "유럽") {
						countryName = "eu";												
					}
					
					else if(area_select.name == "미국") {
						countryName = "us";								
					}
					
					else {
						regionName = area_select.name;					
					}
					
					console.log("regionName: " + regionName)
				}
				
				if(area_detail_select != null) {
					regionName = area_detail_select.name;		
				}
				
				
				location.replace("/board/list?sort=" + str + "&keyword=" + keyword + "&countrycode=" + countryName + "&regionname=" + regionName + "&pagenum=" + pagenum);
			}
		}

		else {			
			// 정렬 방법
			let sort = document.querySelector(".selected").value;
			console.log(sort);
			
			let str = "";
			if(sort == "최신 순") {
				str = "recent";
			}
			
			else if(sort == "인기 순") {
				str = "popular";
			}
			
			else {
				str = "like";
			}
			console.log(str);
			
			// 키워드
			let keyword = document.querySelector(".b_search").value;
			console.log(keyword);
			
			// 국가 코드 및 지역 이름
			const country_select = document.querySelector(".country_select");
			const area_select = document.querySelector(".area_select");
			const area_detail_select = document.querySelector(".area_detail_select");
			
			console.log(country_select)
			console.log(area_select)
					
			let countryName = "";
			let regionName = "";
			if(country_select != null) {
				countryName = country_select.name;
				console.log("countryName: " + countryName)
			}
			
			if(area_select != null) {
				if(area_select.name == "동남아시아") {
					countryName = "ea";
				}
				
				else if(area_select.name == "괌/사이판/호주/뉴질랜드") {
					countryName = "gu";			
				}
				
				else if(area_select.name == "일본") {
					countryName = "jp";								
				}
				
				else if(area_select.name == "중국") {
					countryName = "cn";							
				}
				
				else if(area_select.name == "유럽") {
					countryName = "eu";												
				}
				
				else if(area_select.name == "미국") {
					countryName = "us";								
				}
				
				else {
					regionName = area_select.name;					
				}
				
				console.log("regionName: " + regionName)
			}
			
			if(area_detail_select != null) {
				regionName = area_detail_select.name;		
			}
			
			
			
			location.replace("/board/list?sort=" + str + "&keyword=" + keyword + "&countrycode=" + countryName + "&regionname=" + regionName + "&pagenum=" + pagenum);
		}
		
	}

	// function boardwrite() {
		// let loginUser = /*[[${session.loginUser}]]*/"";  // 세션에 있는 loginUser
		// console.log(loginUser)
		/*
		if(loginUser == null) {
			showAlertModal(2, "로그인 후 이용 가능합니다");
		}
		
		else {
			location.replace("/board/write")
		}
	}
	*/
	
	// function like(e) {
		// let loginUser = /*[[${session.loginUser}]]*/"";
		/*
		if(loginUser == null) {
			alert("로그인 후 이용해주세요.");
		}
	}
	*/
	
	// --------------- 최근 검색어 ---------------
	function getCookie(name) {
	    const cookies = document.cookie.split(';'); // 모든 쿠키를 ';'로 분리하여 배열로 만들어줌
	    for (let i = 0; i < cookies.length; i++) {
	        let cookie = cookies[i].trim(); // 공백 제거
	        if (cookie.startsWith(name + '=')) { // 쿠키 이름으로 시작하는 쿠키를 찾음
				let cookieValue = cookie.substring(name.length + 1); // 찾은 쿠키 값
				// 공백을 다시 원래대로 변환
				cookieValue = cookieValue.replace(/--_--/g, " ");
				return cookieValue; // 찾은 쿠키 값을 반환
	        }
	    }
	    return null; // 해당하는 이름의 쿠키가 없는 경우 null을 반환
	}
	
	// const keywords = getCookie('keywords');
	// console.log(keywords);
	
	
	// 새로운 키워드를 기존 키워드 앞쪽에 추가하는 함수
	function addNewKeyword(keyword) {
	    const keyword_area = document.querySelector('.keyword_area'); // 최근 검색어를 표시할 부모 요소 선택
	    const existingKeywords = document.querySelectorAll('.keyword'); // 기존 키워드 요소들 선택
	    const firstKeyword = existingKeywords[0]; // 첫 번째 기존 키워드 요소
	
	    const keywordDivTag = document.createElement('div'); // 새로운 검색어를 담을 div 요소 생성
	    keywordDivTag.classList.add('keyword'); // 클래스 추가
	    keywordDivTag.innerHTML = `<span>${keyword}</span><div class="xbtn"></div>`; // 검색어와 삭제 버튼을 포함한 HTML 추가
	
	    // 첫 번째 기존 키워드 요소 앞에 새로운 키워드 요소 추가
	    keyword_area.insertBefore(keywordDivTag, firstKeyword);
	}
	
	// 최근 검색어를 가져오고 화면에 표시하는 함수
	function recentKeyword() {
	    const keywords = getCookie('keywords'); // 쿠키에서 검색어 가져오기
		console.log(keywords);
		
	    if (keywords) {
	        const keywordsArray = keywords.split('_-_'); // 구분자를 기준으로 검색어를 배열로 분리
	        keywordsArray.forEach(keyword => {
	            if (!isDuplicate(keyword)) {
	                addNewKeyword(keyword); // 새로운 키워드를 기존 키워드 앞쪽에 추가
	            }
	        });
	    }
	}

	// 중복 검사 함수
	function isDuplicate(keyword) {
	    const existingKeywords = document.querySelectorAll('.keyword span'); // 이미 표시된 검색어 목록 가져오기
	    for (let i = 0; i < existingKeywords.length; i++) {
	        if (existingKeywords[i].textContent === keyword) {
	            return true; // 이미 있는 검색어인 경우 중복으로 처리
	        }
	    }
	    return false; // 중복되지 않은 경우
	}

	// 페이지 로드 시 최근 검색어를 표시
	window.addEventListener('load', recentKeyword);
</script>
</html>