<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>list</title>
</head>
<style>
    /* #90CAF9, #64B5F6, #42A5F5, #2196F3 */
    * {margin: 0; padding: 0; box-sizing: border-box;}
    
	a {text-decoration: none;}
	a:visited, a:active, a:link {color: #000;}
	a:hover {color: #000; cursor: pointer;}
	
    .wrap {
        width: 1400px;
        margin: 0 auto;
    }
	

    .b_banner {
        position: relative;
        width: 100%;
        height: 350px;
        background: url('/images/boardimg/1.jpg') center/cover no-repeat;
    }

    .b_search {
        width: 500px;
        border-radius: 30px;
        background-color: #fff;
        position: absolute;
        top: 42%;
        left: 32%;
        outline: none;
        padding: 20px 20px 20px 63px;
        box-shadow: 0px 4px 20px 0px rgba(25, 25, 25, 0.35);
        font-size: 20px;
        border: 1px solid #fff;
    }

    .b_search:focus {
        caret-color: #2196F3;
        border: 1px solid #2196F3;
    }

    .b_search::placeholder {
        color: #444;
    }

    .b_searchimg {
        width: 43px;
        height: 43px;
        position: absolute;
        top: 45%;
        left: 33%;
    }
	
	.search_cancel {
	    width: 30px; height: 30px;
	    position: absolute;
	    top: 47%;
	    right: 33.2%;
	 }

    .b_searchDetail {
        width: 500px; height: 250px;
        position: absolute;
        top: 64%;
        left: 32%;
        background-color: #fff;
        border-radius: 15px;
        /* display: none; */
        z-index: 1;
        box-shadow: 0px 10px 20px 0px rgba(25, 25, 25, 0.35);
    }

    .b_searchDetail .ximg {
        width: 35px;
        height: 35px;
        position: absolute;
        top: 10px; right: 10px;
    }

    .b_searchDetail .recentsearch {
        border-top: 1px solid rgb(233, 233, 233);
        position: absolute;
        top: 50px;
        width: 100%;
        height: 200px;
        padding: 0 15px;
        padding-top: 10px;
    }

    .recentsearch > div {
        color: black;
        font-size: 14px;
    }

    .recentsearch > div:nth-child(1) {
        font-weight: bold;
        margin-left: 3px;
    }

    .keyword_area {
        margin-top: 12px;
        width: 100%;
        max-height: 153px;
        display: flex;
        flex-wrap: wrap;
        
    }

    .keyword_area > .keyword {
        width: auto;
        border-radius: 15px;
        border: 1px solid #ccc;
        padding: 6px;
        margin-right: 8px;
        margin-bottom: 8px;
        display: flex;

    }

    .keyword > .xbtn {
        width: 18px;
        height: 18px;
        margin-left: 3px;
        background: url('/images/boardimg/xbtn.png') center/cover no-repeat;
    }

    .post_area {
        margin-top: 40px;
        padding: 0 20px;
    }
	
	.post_area > div:last-of-type {
		text-align: center;
		/* margin: 80px 0; */
	}

    .b_buttons {
        height: 40px;
    }

    .nation_area {
        float: right;
        position: relative;
    }

    .sortbtn {
        float: left;
    }

    .sortbtn [type="button"] {
        background-color: #F5F5F5;
        border: 1px solid #F5F5F5;
        padding: 10px;
        border-radius: 10px;
        font-weight: 500;
        color: #4e4c4c;
        margin-right: 5px;
    }

    .sortbtn [type="button"]:first-child {
        background-color: #000;
        color: #fff;
    }
   
	.nation_area > button {
	        width: 80px;
	        background-color: #fff;
	        border: 1px solid rgb(233, 233, 233);
	        padding: 10px 13px 10px;
	        border-radius: 10px;
	        font-weight: 500;
	        color: #4e4c4c;
	        position: relative;
	        text-align: right;
	        float: right;
			cursor: pointer;
	}
		
	.nation_select {
	    position: absolute;
	    width: 350px; height: 340px;
	    background-color: #fff;
	    border: 1px solid rgb(233, 233, 233);
	    border-radius: 10px;
	    top: 55px; right: 0;
	    box-shadow: 0px 0px 3px rgba(30, 30, 30, 0.15);
	}
	
	.nation_select .category {
	    position: absolute;
	    width: 100%; height: 280px;
	    display: flex;
	    padding: 5px;
	    flex-wrap: nowrap;
	    justify-content: space-between;
	    /* display: none; */
	}
	
	.nation_select .category > * {
	    width: 33.3%;
	    height: 280px;
	}
	
	.nation_select .nation {
	    border-radius: 10px 0 0 10px / 10px 0 0 10px;
	    border: 1px solid rgb(233, 233, 233);
	    padding: 3px;
	}

	.nation_select .region {
    	border-top: 1px solid rgb(233, 233, 233);
    	border-bottom: 1px solid rgb(233, 233, 233);
		padding: 3px;
	}
		
	.nation_select .region_detail {
		border-radius: 0 10px 10px 0 / 0 10px 10px 0;
		border: 1px solid rgb(233, 233, 233);
	}
		
	.nation_select .nation > div, .region > div {
		width: 100%;
	}
	
	.nation_select .nation > div > button, .region > div > button {
	    display: block;
	    width: 100%;
	    padding: 8px;
	    border: none;
	    background-color: #fff;
		cursor: pointer;
	}
	
	.nation_select .nation > div > button > p, .nation_select .region > div > button > p {
	    width: 100%;
	    text-align: left;
	    white-space: nowrap;
	    overflow: hidden;
	    text-overflow: ellipsis;
	}
	
	.nation_select .n_btns {
	   position: absolute;
	   bottom: 9px; left: 24px;
	}
	
	.n_btns button {
		background-color: #fff;
	    border-radius: 5px;
	    height: 35px;
	    font-size: 12px;
	    font-weight: bold;
	}
	
	.n_btns button:nth-child(1) {
		width: 90px;
	    margin-right: 5px;
	    color: #2196F3;
	    background-color: #F5F5F5;
	    border: 1px solid #F5F5F5;
	}
	
	.n_btns button:nth-child(1) img {
		width: 18px;
	    height: 18px;
	    position: absolute;
	    left: 15px; top: 9px;
	}
	
	.n_btns button:nth-child(1) span {
	    margin-left: 18px;
	}
	
	.n_btns button:nth-child(2) {
	    width: 200px;
	    color: #fff;
	    background-color: #2196F3;
	    border: 1px solid #2196F3;
	}
	
	.settings {
	    width: 19px; height: 19px;
	    position: absolute;
	    top:9px; left: 13px;
	}

    .posts {
        margin-top: 30px;
        display: flex;
        flex-wrap: wrap;
        overflow-y: auto;
        gap: 26.6px;  /* 전체에 여백 */
        padding-bottom: 10px;
    }

    .posts .post {
        width: 320px;
        height: 300px;
        border-radius: 14px;
        box-shadow: 0px 3px 8px rgba(25, 25, 25, 0.2);
    }

    .post > .guide {
        height: 45px;
        padding: 10px;
        font-size: 14px;
        line-height: 16px;
        display: flex;
    }

    .post > .guide img {
        width: 30px;
        height: 30px;
        margin-right: 7px;
    }

    .post > .guide span {
        margin-top: 5px;
    }

    .post > .p_img {
        width: 100%;
        height: 160px;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 12px;
    }

    .posts > a:hover {
        cursor: pointer;
    }

    .posts > a:hover .p_img > img {
        transform: scale(1.2);
        transition: 0.25s ease-in-out;
    }

    .post > .post_write {
        padding: 10px;
        height: 95px;
    }

    .post > .post_write > .post_title {
        margin-bottom: 7px;
        
    }

    .post > .post_write > .post_title {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-weight: bold;
        font-size: 17px;
    }

    .post > .post_write > .post_preview {
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        color: #777;
        font-size: 15px;
    }
	
    .b_pagenation {
        margin-top: 70px;
        display: flex;
        justify-content: center;
    }

    .b_pagenation img {
        width: 20px; height: 20px;
        margin-top: 5px;
    }

    .b_pagenation a {
        font-size: 18px;
        font-weight: bold;
        width: 33px; height: 33px;
        text-align: center;
        margin-right: 15px;
        border: 1px solid rgb(233, 233, 233);
        border-radius: 5px;
        line-height: 28px;
    }
	
	.b_pagenation a:first-of-type {
	     background: url("/images/boardimg/prev.png") no-repeat center/20px 20px;
	 }
	
	 .b_pagenation a:last-of-type {
	     background: url("/images/boardimg/next.png") no-repeat center/20px 20px;
	     margin-right: 0;
	 }


</style>
<body>
    <div class="wrap">
		
        <div class="b_banner">
            <input type="text" placeholder="검색" class="b_search" onkeydown="clickEnter(event)">
            <img src="/images/boardimg/b_search.png" alt="검색아이콘" class="b_searchimg">
			<img src="/images/boardimg/cross.png" alt="" class="search_cancel" style="visibility: hidden;">
            <div class="b_searchDetail" style="display: none;">
                <img src="/images/boardimg/x_icon.png" alt="" class="ximg">
                <div class="recentsearch">
                    <div>최근 검색어</div>
                    <div class="keyword_area">
                        <div class="keyword"><span>검색어</span><div class="xbtn"></div></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 정렬 방법 -->
        <div class="post_area">
            <div class="b_buttons">
                <div class="sortbtn">
                    <input type="button" value="최신 순" class="sort selected">
                    <input type="button" value="인기 순" class="sort">
                    <input type="button" value="좋아요 순" class="sort">
                </div>
    
                <div class="nation_area">
                    <button><img src="/images/boardimg/settings.png" alt="설정" class="settings">국가</button>
					<div class="nation_select" style="display: none;">
						<div class="category">
						    <div class="nation">
						        <div>
						            <button class="countrybtn" name="kr"><p class="countrystr">국내</p></button>
						            <button class="countrybtn" name="fr"><p class="countrystr">해외</p></button>
						        </div>
						    </div>
						
						    <div class="region">
						        <div style="visibility: hidden;">
						            <button class="area" name="서울"><p class="areastr">서울</p></button>
						            <button class="area" name="제주도"><p class="areastr">제주도</p></button>
						            <button class="area" name="경기도"><p class="areastr">경기도</p></button>
						            <button class="area" name="강원도"><p	class="areastr">강원도</p></button>
						            <button	class="area" name="충청도"><p class="areastr">충청도</p></button>
						            <button	class="area" name="경상도"><p class="areastr">경상도</p></button>
						            <button class="area" name="전라도"><p class="areastr">전라도</p></button>
						            <button class="area" name="인천광역시"><p class="areastr">인천광역시</p></button>	
						        </div>
						    </div>
						    <div class="region_detail"></div>
						</div>
						
						<div class="n_btns">
						    <button onclick="reset();"><img src="/images/boardimg/reset.png" alt=""><span>초기화</span></button>
							<button onclick="regionSearch();">적용</button>
						</div>
                    </div>
                </div>
            </div>

            <!-- 게시글 목록 -->
            <section class="posts">
                <!-- 게시글 -->
                <a th:if="${list != null and list.size > 0}" th:each="board:${list}" th:href="@{/board/get(boardnum=${board.boardnum})}">
                    <div class="post">
                        <div class="guide">
                            <img src="/images/boardimg/profile.png" alt="">
                            <span>[[${board.userid}]]</span>
                        </div>

                        <div class="p_img">
                            <img src="/images/boardimg/2.jpg" alt="">
                        </div>
                        
                        <div class="post_write">
                            <div class="post_title">[[${board.title}]]</div>
                            <div class="post_preview">[[${board.content}]]</div>
                        </div>
                    </div>
                </a>
            </section>
			
			<div th:if="${list == null or list.size == 0}" class="no_list">
				<div class="no_post">등록된 게시글이 없습니다.</div>
			</div>
        </div>

        <!-- 페이지 네이션 -->
        <div class="b_pagenation">
            <a class="changePage b_prevbtn" th:id="${pageMaker.cri.pagenum - 1}" th:href="${pageMaker.cri.pagenum - 1}"></a>
			<!--<a class="changePage b_prevbtn" th:id="${pageMaker.startPage - 1}" th:href="${pageMaker.startPage - 1}"></a>-->
            
			<th:block th:each="i : ${#numbers.sequence(pageMaker.startPage, pageMaker.endPage)}">
				<a class="page" th:id="${i}" th:if="${pageMaker.cri.pagenum == i}">[[${i}]]</a>
				<a class="changePage page" th:id="${i}" th:href="${i}" th:unless="${pageMaker.cri.pagenum == i}">[[${i}]]</a>
			</th:block>
			<!--
			<a>1</a>
            <a>2</a>
            <a>3</a>
            <a>4</a>
            <a>5</a>
			-->
            <a class="changePage b_nextbtn" th:id="${pageMaker.cri.pagenum + 1}" th:href="${pageMaker.cri.pagenum + 1}"></a>
        </div>
		
		<input type="hidden" id="startPage" th:value="${pageMaker.startPage}">
		<input type="hidden" id="realEndPage" th:value="${pageMaker.realEnd}">
		<input type="hidden" id="pagenum" th:value="${pageMaker.cri.pagenum}">
		<input type="hidden" id="keyword" th:value="${pageMaker.cri.keyword}">
		<input type="hidden" id="countrycode" th:value="${pageMaker.cri.countrycode}">
		<input type="hidden" id="regionname" th:value="${pageMaker.cri.regionname}">
		<input type="hidden" id="method" th:value="${sort}">
    </div>
</body>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script th:inline="javascript">
	const sort = document.getElementsByClassName("sort");  // 최신순, 인기순, 좋아요순 버튼
	const b_search = document.querySelector(".b_search");  // 검색창
	const b_searchDetail = document.querySelector(".b_searchDetail");
	const ximg = document.querySelector(".ximg");
	const search_cancel = document.querySelector(".search_cancel");
	const region_div = document.querySelector(".region > div");
	const country_select = document.querySelector(".country_select");  // 국내, 해외
	const area_select = document.querySelector(".area_select");  // 서울, 경기도 등 지역
	
	console.log(country_select)
	console.log(area_select)
	
	
	const startPage = document.getElementById("startPage").value;
	let realEndPage = document.getElementById("realEndPage").value;
	const page = document.getElementById("pagenum").value;
	const keyword = document.getElementById("keyword").value;
	const countrycode = document.getElementById("countrycode").value;
	const regionname = document.getElementById("regionname").value;
	const method = document.getElementById("method").value;
	
	console.log("startPage: " + startPage)
	console.log("realEndPage: " + realEndPage)
	console.log("page: " + page)
	console.log("keyword: " + keyword)
	console.log("countrycode: " + countrycode)
	console.log("regionname: " + regionname)
	console.log("method: " + method)
	
	
	
	if(keyword != "") {
		b_search.value = keyword;
		search_cancel.style.visibility = "visible";
	}
	
	if(countrycode != "") {
		const countrybtn = document.getElementsByClassName("countrybtn");
		
		if(countrycode == "kr") {
			countrybtn[0].style.backgroundColor = "#f0f0f0";
			countrybtn[0].classList.add("country_select");
		}
		
		else if(countrycode == "fr") {
			countrybtn[1].style.backgroundColor = "#f0f0f0";
			countrybtn[1].classList.add("country_select");
		}
	}
	
	if(regionname != "") {
		const area = document.getElementsByClassName("area");
		
		if(regionname == "서울") {
			area[0].style.backgroundColor = "#f0f0f0";
			area[0].classList.add("area_select");
		}
		
		else if(regionname = "제주도") {
			area[1].style.backgroundColor = "#f0f0f0";
			area[1].classList.add("area_select");
		}
		
		else if(regionname = "경기도") {
			area[2].style.backgroundColor = "#f0f0f0";
			area[2].classList.add("area_select");	
		}
		
		else if(regionname = "강원도") {
			area[3].style.backgroundColor = "#f0f0f0";
			area[3].classList.add("area_select");	
		}
		
		else if(regionname = "충청도") {
			area[4].style.backgroundColor = "#f0f0f0";
			area[4].classList.add("area_select");
		}
		
		else if(regionname = "경상도") {
			area[5].style.backgroundColor = "#f0f0f0";
			area[5].classList.add("area_select");	
		}
		
		else if(regionname = "전라도") {
			area[6].style.backgroundColor = "#f0f0f0";
			area[6].classList.add("area_select");
		}
		
		else if(regionname = "인천광역시") {
			area[7].style.backgroundColor = "#f0f0f0";
			area[7].classList.add("area_select");
		}
	}
	
	if(method != "") {
		for(let i = 0; i < sort.length; i++) {
			sort[i].classList.remove("selected");  // selected 클래스 모두 제거
			sort[i].style.backgroundColor = "#F5F5F5";
			sort[i].style.color = "#4e4c4c";
		}
		
		if(method == "recent") {
			sort[0].style.backgroundColor = "#000";
			sort[0].style.color = "#fff";
			sort[0].classList.add("selected");
		}
		
		else if(method == "popular") {
			sort[1].style.backgroundColor = "#000";
			sort[1].style.color = "#fff";
			sort[1].classList.add("selected");
		}
		
		else if(method == "like") {
			sort[2].style.backgroundColor = "#000";
			sort[2].style.color = "#fff";
			sort[2].classList.add("selected");
		}
	}
	
	
	
	
		
	// 검색창 focus 되었을 때
	b_search.addEventListener("focus", function() {
		b_searchDetail.style.display = "block";
	});
	
	// 검색창과 최근검색어 창 클릭을 제외하고 다른 곳을 클릭한다면 최근검색어 창이 뜨지 않도록
	// 문서 전체를 클릭했을 때
	document.addEventListener("click", function(e) {
		// 클릭한 부분이 검색창 또는 최근검색어 창인지 확인
	    if (!b_search.contains(event.target) && !b_searchDetail.contains(event.target)) {
			// 클릭한 부분이 검색창 또는 최근검색어 창이 아니라면 display: none;
	        b_searchDetail.style.display = "none";
	    }
	});
	
	// 검색창에 검색어 입력하다가 다 지운 경우
	b_search.addEventListener('input', function() {
	    // 검색창에 입력한게 없다면 입력창에 있는 X 버튼 숨기기
	    if (!b_search.value) {
			search_cancel.style.visibility = 'hidden';
	    } 
		
		else {
			search_cancel.style.visibility = 'visible';
	    }
	});

	// 최근 검색어 창에 있는 X 버튼 클릭했을 때
	ximg.addEventListener("click", function() {
		b_searchDetail.style.display = "none";
		b_search.value = "";
		search_cancel.style.visibility = "hidden";
	});
	
	// 검색어 입력 창에 있는 X 버튼 클릭했을 때
	search_cancel.addEventListener("click", function() {
		console.log(b_search.value)
		b_search.value = "";
		console.log(b_search.value)
		search_cancel.style.visibility = "hidden";
		b_searchDetail.style.display = "none";
	});
	
		
	// 정렬 버튼(최신순, 좋아요순, 인기순) 클릭 시 listsort 함수 호출
	for(let i = 0; i < sort.length; i++) {
		sort[i].addEventListener("click", listsort);
	}
	
	// 정렬 버튼(최신순, 좋아요순, 인기순) 클릭 시 리스트
	function listsort(e) {
		console.log(e.target);
		
		for(let i = 0; i < sort.length; i++) {
			sort[i].classList.remove("selected");  // selected 클래스 모두 제거
		}
		
		let obj = e.target;
		let text = obj.value;  // 최신순, 좋아요순, 인기순
		
		obj.classList.add("selected");  // 클릭한 버튼에만 selected 클래스 추가
		
		let keyword = document.querySelector(".b_search").value;
		console.log(keyword);
		
		// keyword = keyword == "" ? null : keyword;
		
		let str = "";
		if(text == "최신 순") {
			str = "recent";
		}
		
		else if(text == "인기 순") {
			str = "popular";
		}
		
		else {
			str = "like";
		}
		console.log(str);
		
		const country_select = document.querySelector(".country_select");
		const area_select = document.querySelector(".area_select");
		console.log(country_select)
		console.log(area_select)
				
		let countryName = "";
		let regionName = "";
		if(country_select != null) {
			countryName = country_select.name;
			console.log("countryName: " + countryName)
		}
		
		if(area_select != null) {
			regionName = area_select.name;
			console.log("regionName: " + regionName)
		}
		
		
		$.ajax({
			url: "/board/sort?sort=" + str + "&keyword=" + keyword + "&countrycode=" + countryName + "&regionname=" + regionName,
			method: "GET",
			
			success:function(data) {
				// console.log("O")
				// console.log(data)
				// console.log(data.sortlist[0].boardnum)
			
				// 정렬 버튼 색 초기화
				for(let i = 0; i < sort.length; i++) {
					sort[i].style.backgroundColor = "#F5F5F5";
					sort[i].style.color = "#4e4c4c";
				}
				
				// 현재 정렬 조건인 버튼 색 변경
				if(data.sortValue == null || data.sortValue == "recent") {
					sort[0].style.backgroundColor = "#000";
					sort[0].style.color = "#fff";
				}
				
				else if(data.sortValue == "popular") {
					sort[1].style.backgroundColor = "#000";
					sort[1].style.color = "#fff";
				}
				
				else if(data.sortValue == "like") {
					sort[2].style.backgroundColor = "#000";
					sort[2].style.color = "#fff";
				}
				
				// DOM 구현
				$(".posts").empty();
				$(".b_pagenation").empty();
				$(".no_list").remove();
				
				if(data.sortlist.length == 0) {
					if($(".no_list").length === 0) {
						let no_list = $("<div>").attr("class", "no_list");
						$(".post_area").append(no_list);
						
						
						$(".no_list").empty();  // 기존에 있던 .no_post 내용 없앰
						let divTag = $("<div>").attr("class", "no_post").text("등록된 게시글이 없습니다.");
						$(".no_list").append(divTag);
						
						// 페이지 네이션
						// 이전 버튼
						let b_prevbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum - 1 + "").addClass("changePage b_prevbtn").attr("id", data.pageMaker.cri.pagenum - 1);
						$(".b_pagenation").append(b_prevbtn);
						
						// 페이지
						let currentPage = $("<a>").text(1).addClass("page").attr("id", 1);
						$(".b_pagenation").append(currentPage);
						
						// 다음 버튼
						let b_nextbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum + 1 + "").addClass("changePage b_nextbtn").attr("id", data.pageMaker.cri.pagenum + 1);							
						$(".b_pagenation").append(b_nextbtn);
						
						realEndPage = data.pageMaker.realEnd;
						console.log("realEndPageTest: " + realEndPage)
					}
				}
				
				else {
					for(let i = 0; i < data.sortlist.length; i++) {
						// .attr: 속성 추가
						// .addClass: 클래스 추가
						let aTag = $("<a>").attr("href", "/board/get?boardnum=" + data.sortlist[i].boardnum);
						let divPost = $("<div>").addClass("post");
							
						let divGuide = $("<div>").addClass("guide");
						let profile = $("<img>").attr("src", "/images/boardimg/profile.png");
						let spanTag = $("<span>").text(data.sortlist[i].userid);
							
						divGuide.append(profile, spanTag);
							
						let divpImg = $("<div>").addClass("p_img");
						let boardimg = $("<img>").attr("src", "/images/boardimg/2.jpg");
						
						divpImg.append(boardimg);
						
						let divWrite = $("<div>").addClass("post_write");
						let postTitle = $("<div>").addClass("post_title").text(data.sortlist[i].title);
						let postPrev = $("<div>").addClass("post_preview").text(data.sortlist[i].content);
							
						divWrite.append(postTitle, postPrev);
						
						divPost.append(divGuide, divpImg, divWrite);
						aTag.append(divPost);
						
						$(".posts").append(aTag);
					}
					
					// 페이지 네이션
					// 이전 버튼
					let b_prevbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum - 1 + "").addClass("changePage b_prevbtn").attr("id", data.pageMaker.cri.pagenum - 1);
					$(".b_pagenation").append(b_prevbtn);
					
					// 페이지
					for(let i = data.pageMaker.startPage; i <= data.pageMaker.endPage; i++) {							
						if(data.pageMaker.cri.pagenum == i) {
							let currentPage = $("<a>").text(i).addClass("page").attr("id", i);
							$(".b_pagenation").append(currentPage);
						}
						else {								
							let changePage = $("<a>").attr("href", i).addClass("changePage page").text(i).attr("id", i);
							$(".b_pagenation").append(changePage);
						}
					}
					
					// 다음 버튼
					let b_nextbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum + 1 + "").addClass("changePage b_nextbtn").attr("id", data.pageMaker.cri.pagenum + 1);		
					$(".b_pagenation").append(b_nextbtn);
					
					realEndPage = data.pageMaker.realEnd;
					console.log("realEndPageTest: " + realEndPage)
				}
				
				$(".page").each(function() {
				    if ($(this).text().trim() == "1") {
				        $(this).css("color", '#2196F3');
				        $(this).css("border-color", '#2196F3');
				    }
				});
				
			},
			
			error:function() {
				// console.log("X")
				alert("잠시 후에 다시 시도해주세요.");
			}
			
		})
		
	}
	
	function clickEnter(e) {
		if(e.keyCode == 13) {  // 엔터 키 클릭 시
			search(e.target.value);
			b_searchDetail.style.display = "none";
		}
	}
	
	function search(keyword) {
		
		if(keyword == "") {
			alert("검색어를 입력해주세요");
			e.target.focus();
		}
		
		let sort = document.querySelector(".selected").value;
		console.log(sort);
		
		let str = "";
		if(sort == "최신 순") {
			str = "recent";
		}
		
		else if(sort == "인기 순") {
			str = "popular";
		}
		
		else {
			str = "like";
		}
		console.log(str);
		
		const country_select = document.querySelector(".country_select");
		const area_select = document.querySelector(".area_select");
		console.log(country_select)
		console.log(area_select)
				
		let countryName = "";
		let regionName = "";
		if(country_select != null) {
			countryName = country_select.name;
			console.log("countryName: " + countryName)
		}
		
		if(area_select != null) {
			regionName = area_select.name;
			console.log("regionName: " + regionName)
		}
		
		$.ajax({
			url: "/board/sort?sort=" + str + "&keyword=" + keyword + "&countrycode=" + countryName + "&regionname=" + regionName,		
			method: "GET",
			
			success:function(data) {
				// console.log("O")
				// console.log(result)
				// console.log(result.searchList.length)
				
				// DOM 구현
				$(".posts").empty();
				$(".b_pagenation").empty();
				$(".no_list").remove();
				
				if(data.sortlist.length == 0) {
					if($(".no_list").length === 0) {
						let no_list = $("<div>").attr("class", "no_list");
						$(".post_area").append(no_list);
						
						
						$(".no_list").empty();  // 기존에 있던 .no_post 내용 없앰
						let divTag = $("<div>").attr("class", "no_post").text("등록된 게시글이 없습니다.");
						$(".no_list").append(divTag);
						
						// 페이지 네이션
						// 이전 버튼
						let b_prevbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum - 1 + "").addClass("changePage b_prevbtn").attr("id", data.pageMaker.cri.pagenum - 1);
						$(".b_pagenation").append(b_prevbtn);
						
						// 페이지
						let currentPage = $("<a>").text(1).addClass("page").attr("id", 1);
						$(".b_pagenation").append(currentPage);
						
						// 다음 버튼
						let b_nextbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum + 1 + "").addClass("changePage b_nextbtn").attr("id", data.pageMaker.cri.pagenum + 1);		
						$(".b_pagenation").append(b_nextbtn);
						
						realEndPage = data.pageMaker.realEnd;
						console.log("realEndPageTest: " + realEndPage)
					}
				}
				
				else {
					$(".no_list").remove();
					
					for(let i = 0; i < data.sortlist.length; i++) {
						// .attr: 속성 추가
						// .addClass: 클래스 추가
						let aTag = $("<a>").attr("href", "/board/get?boardnum=" + data.sortlist[i].boardnum);
						let divPost = $("<div>").addClass("post");
							
						let divGuide = $("<div>").addClass("guide");
						let profile = $("<img>").attr("src", "/images/boardimg/profile.png");
						let spanTag = $("<span>").text(data.sortlist[i].userid);
							
						divGuide.append(profile, spanTag);
							
						let divpImg = $("<div>").addClass("p_img");
						let boardimg = $("<img>").attr("src", "/images/boardimg/2.jpg");
						
						divpImg.append(boardimg);
						
						let divWrite = $("<div>").addClass("post_write");
						let postTitle = $("<div>").addClass("post_title").text(data.sortlist[i].title);
						let postPrev = $("<div>").addClass("post_preview").text(data.sortlist[i].content);
							
						divWrite.append(postTitle, postPrev);
						
						divPost.append(divGuide, divpImg, divWrite);
						aTag.append(divPost);
						
						$(".posts").append(aTag);
					}
					
					// 페이지 네이션
					// 이전 버튼
					let b_prevbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum - 1 + "").addClass("changePage b_prevbtn").attr("id", data.pageMaker.cri.pagenum - 1);
					$(".b_pagenation").append(b_prevbtn);
					
					// 페이지
					for(let i = data.pageMaker.startPage; i <= data.pageMaker.endPage; i++) {							
						if(data.pageMaker.cri.pagenum == i) {
							let currentPage = $("<a>").text(i).addClass("page").attr("id", i);
							$(".b_pagenation").append(currentPage);
						}
						else {								
							let changePage = $("<a>").attr("href", i).addClass("changePage page").text(i).attr("id", i);
							$(".b_pagenation").append(changePage);
						}
					}
					
					// 다음 버튼
					let b_nextbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum + 1 + "").addClass("changePage b_nextbtn").attr("id", data.pageMaker.cri.pagenum + 1);		
					$(".b_pagenation").append(b_nextbtn);
					
					realEndPage = data.pageMaker.realEnd;
					console.log("realEndPageTest: " + realEndPage)	
				}
				
				$(".page").each(function() {
				    if ($(this).text().trim() == "1") {
				        $(this).css("color", '#2196F3');
				        $(this).css("border-color", '#2196F3');
				    }
				});
			},
			
			error:function(data) {
				// console.log("X")
				alert("잠시 후에 다시 시도해주세요.");
			}
			
		})
	}
	
	// 국가 버튼 클릭 시 카테고리 선택 창
	const nationBtn = document.querySelector(".nation_area > button");
	const nation_select = document.querySelector(".nation_select");
	// console.log(nationBtn)
	nationBtn.addEventListener("click", nation);
	
	let flag = false;
	function nation() {
		if(!flag) {
			flag = true;
			nation_select.style.display = "flex";
		}
		
		else {
			nation_select.style.display = "none";
			flag = false;
			
		}
	}
	
	const countrybtn = document.getElementsByClassName("countrybtn");
	const countrystr = document.getElementsByClassName("countrystr");
	
	for(let i = 0; i < countrystr.length; i++) {
		countrystr[i].addEventListener("click", function(e) {
			// p태그 클릭 시 이벤트 막고 그 부모 요소가 클릭되도록
			e.stopPropagation();  // 이벤트 막음
			this.parentElement.click();  // 부모 요소(button 태그 클릭)
		})
	}
	
	for(let i = 0; i < countrybtn.length; i++) {
		countrybtn[i].addEventListener("click", countryClick);
	}
	
	function countryClick(e) {
		// 국내, 해외 버튼 색 초기화
		for(let i = 0; i < countrybtn.length; i++) {
			countrybtn[i].style.backgroundColor = "#fff";
			countrybtn[i].classList.remove("country_select");
		}
		
		let obj = e.target;
		obj.style.backgroundColor = "#f0f0f0";
		console.log(obj.textContent)  // obj.textContent: obj의 모든 텍스트(자식 요소의 텍스트 포함)
		
		const region_div = document.querySelector(".region > div");
		if(obj.textContent == "국내") {
			region_div.style.visibility = "visible";
		}
		
		else if(obj.textContent == "해외") {
			//alert("아직 진행 중")
			region_div.style.visibility = "hidden";
			if(area_select != null) {			
				area_select.classList.remove("area_select");
			}
			
		}
		obj.classList.add("country_select");
	}
	
	const area = document.getElementsByClassName("area");
	const areastr = document.getElementsByClassName("areastr");
	
	for(let i = 0; i < areastr.length; i++) {
		areastr[i].addEventListener("click", function(e) {
			// p태그 클릭 시 이벤트 막고 그 부모 요소가 클릭되도록
			e.stopPropagation();  // 이벤트 막음
			this.parentElement.click();  // 부모 요소(button 태그 클릭)
		});
	}
	
	for(let i = 0; i < area.length; i++) {
		area[i].addEventListener("click", areaClick);
	}
	
	function areaClick(e) {
		let obj = e.target;
		
		// 지역 버튼 색상 초기화
		for(let i = 0; i < area.length; i++) {
			area[i].style.backgroundColor = "#fff";
			area[i].classList.remove("area_select");
		}
		
		obj.style.backgroundColor = "#f0f0f0";
		obj.classList.add("area_select");
	}
	
	function regionSearch() {
		const country = document.querySelector(".country_select");
		const region = document.querySelector(".area_select");
		//const countryName = country.name;
		
		// 국내, 해외 선택하지 않은 경우
		if(country == null) {
			alert("나라를 선택해주세요")
		}
		
		// 국내, 해외 선택
		else {
			nation_select.style.display = "none";
			flag = false;
			
			const countryName = country.name;
			console.log("countryName: " + countryName);
			
			let regionName = "";
			
			// 지역 선택
			if(region != null) {
				regionName = region.name;
			}
			console.log("regionName: " + regionName);
			
			let sort = document.querySelector(".selected").value;
			console.log(sort);
			
			let str = "";
			if(sort == "최신 순") {
				str = "recent";
			}
			
			else if(sort == "인기 순") {
				str = "popular";
			}
			
			else {
				str = "like";
			}
			console.log(str);
			
			let keyword = document.querySelector(".b_search").value;
			console.log(keyword);
			
			$.ajax({
				url: "/board/sort?sort=" + str + "&keyword=" + keyword + "&countrycode=" + countryName + "&regionname=" + regionName,
				method: "GET",
				
				success:function(data) {
					//console.log("O")
					
					// DOM 구현
					$(".posts").empty();
					$(".b_pagenation").empty();
					$(".no_list").remove();
					
					if(data.sortlist.length == 0) {
						if($(".no_list").length === 0) {
							let no_list = $("<div>").attr("class", "no_list");
							$(".post_area").append(no_list);
							
							
							$(".no_list").empty();  // 기존에 있던 .no_post 내용 없앰
							let divTag = $("<div>").attr("class", "no_post").text("등록된 게시글이 없습니다.");
							$(".no_list").append(divTag);
							
							// 페이지 네이션
							// 이전 버튼
							let b_prevbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum - 1 + "").addClass("changePage b_prevbtn").attr("id", data.pageMaker.cri.pagenum - 1);
							$(".b_pagenation").append(b_prevbtn);
							
							// 페이지
							let currentPage = $("<a>").text(1).addClass("page").attr("id", 1);
							$(".b_pagenation").append(currentPage);
							
							// 다음 버튼
							let b_nextbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum + 1 + "").addClass("changePage b_nextbtn").attr("id", data.pageMaker.cri.pagenum + 1);		
							$(".b_pagenation").append(b_nextbtn);
							
							realEndPage = data.pageMaker.realEnd;
							console.log("realEndPageTest: " + realEndPage)
						}
					}
					
					else {
						$(".no_list").remove();
						
						for(let i = 0; i < data.sortlist.length; i++) {
							// .attr: 속성 추가
							// .addClass: 클래스 추가
							let aTag = $("<a>").attr("href", "/board/get?boardnum=" + data.sortlist[i].boardnum);
							let divPost = $("<div>").addClass("post");
								
							let divGuide = $("<div>").addClass("guide");
							let profile = $("<img>").attr("src", "/images/boardimg/profile.png");
							let spanTag = $("<span>").text(data.sortlist[i].userid);
								
							divGuide.append(profile, spanTag);
								
							let divpImg = $("<div>").addClass("p_img");
							let boardimg = $("<img>").attr("src", "/images/boardimg/2.jpg");
							
							divpImg.append(boardimg);
							
							let divWrite = $("<div>").addClass("post_write");
							let postTitle = $("<div>").addClass("post_title").text(data.sortlist[i].title);
							let postPrev = $("<div>").addClass("post_preview").text(data.sortlist[i].content);
								
							divWrite.append(postTitle, postPrev);
							
							divPost.append(divGuide, divpImg, divWrite);
							aTag.append(divPost);
							
							$(".posts").append(aTag);
						}
						
						// 페이지 네이션
						// 이전 버튼
						let b_prevbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum - 1 + "").addClass("changePage b_prevbtn").attr("id", data.pageMaker.cri.pagenum - 1);
						$(".b_pagenation").append(b_prevbtn);
						
						// 페이지
						for(let i = data.pageMaker.startPage; i <= data.pageMaker.endPage; i++) {							
							if(data.pageMaker.cri.pagenum == i) {
								let currentPage = $("<a>").text(i).addClass("page").attr("id", i);
								$(".b_pagenation").append(currentPage);
							}
							else {								
								let changePage = $("<a>").attr("href", i).addClass("changePage page").text(i).attr("id", i);
								$(".b_pagenation").append(changePage);
							}
						}
						
						// 다음 버튼
						let b_nextbtn = $("<a>").attr("href", data.pageMaker.cri.pagenum + 1 + "").addClass("changePage b_nextbtn").attr("id", data.pageMaker.cri.pagenum + 1);		
						$(".b_pagenation").append(b_nextbtn);
						
						realEndPage = data.pageMaker.realEnd;
						console.log("realEndPageTest: " + realEndPage)
						
					}
					
					$(".page").each(function() {
					    if ($(this).text().trim() == "1") {
					        $(this).css("color", '#2196F3');
					        $(this).css("border-color", '#2196F3');
					    }
					});
				},
				
				error:function(data) {
					// console.log("X")
					alert("잠시 후에 다시 시도해주세요.");
				}
			})
		}
	}
	
	
	function reset() {
		// 국내, 해외 버튼 색 초기화
		for(let i = 0; i < countrybtn.length; i++) {
			countrybtn[i].style.backgroundColor = "#fff";
		}
		
		// 지역 버튼 색 초기화
		for(let i = 0; i < area.length; i++) {
			area[i].style.backgroundColor = "#fff";
		}
		
		const country_select = document.querySelector(".country_select");
		const area_select = document.querySelector(".area_select");
		
		if(country_select != null) {			
			country_select.classList.remove("country_select");
		}
		
		if(area_select != null) {			
			area_select.classList.remove("area_select");
		}
		
		//nation_select.style.display = "none";
		//flag = false;
		region_div.style.visibility = "hidden";
	}
	
	// 페이징 처리 부분의 이전 버튼과 다음 버튼, 이동할 페이지 번호 버튼 클릭 시 이벤트 막음
	$(document).ready(function() {
	    $(document).on('click', '.changePage', function(e) {
	        e.preventDefault(); // 이벤트 막음
			pageChange(e);
	    });
		
		$(".page").each(function() {
			if($(this).text().trim() == page) {
				$(this).css("color", '#2196F3');
				$(this).css("border-color", '#2196F3');
			}
		});
	});
	
	function pageChange(e) {
		console.log(e.target)
		console.log(e.target.id)
		// e.currentTarget
		
		// 이동할 페이지 번호
		let pagenum = e.target.id;
		// b_prev <= 0 || b_next > realEndPage
		console.log("realEnd: " + realEndPage)
		
		const prev = document.querySelector(".b_prevbtn");
		const next =document.querySelector(".b_nextbtn");
		
		if(e.target.classList.contains('b_prevbtn')) {
			if(pagenum <= 0) {
				alert("첫번째 페이지입니다.")
			}
			
			else {
				// 정렬 방법
				let sort = document.querySelector(".selected").value;
				console.log(sort);
				
				let str = "";
				if(sort == "최신 순") {
					str = "recent";
				}
				
				else if(sort == "인기 순") {
					str = "popular";
				}
				
				else {
					str = "like";
				}
				console.log(str);
				
				// 키워드
				let keyword = document.querySelector(".b_search").value;
				console.log(keyword);
				
				// 국가 코드 및 지역 이름
				const country_select = document.querySelector(".country_select");
				const area_select = document.querySelector(".area_select");
				console.log(country_select)
				console.log(area_select)
						
				let countryName = "";
				let regionName = "";
				if(country_select != null) {
					countryName = country_select.name;
					console.log("countryName: " + countryName)
				}
				
				if(area_select != null) {
					regionName = area_select.name;
					console.log("regionName: " + regionName)
				}
				
				
				
				location.replace("/board/list?sort=" + str + "&keyword=" + keyword + "&countrycode=" + countryName + "&regionname=" + regionName + "&pagenum=" + pagenum);
			}
		}
		
		else if(e.target.classList.contains('b_nextbtn')) {
			if(parseInt(pagenum) > parseInt(realEndPage)) {
				alert("마지막 페이지입니다.")
			}
			
			else {
				// 정렬 방법
				let sort = document.querySelector(".selected").value;
				console.log(sort);
				
				let str = "";
				if(sort == "최신 순") {
					str = "recent";
				}
				
				else if(sort == "인기 순") {
					str = "popular";
				}
				
				else {
					str = "like";
				}
				console.log(str);
				
				// 키워드
				let keyword = document.querySelector(".b_search").value;
				console.log(keyword);
				
				// 국가 코드 및 지역 이름
				const country_select = document.querySelector(".country_select");
				const area_select = document.querySelector(".area_select");
				console.log(country_select)
				console.log(area_select)
						
				let countryName = "";
				let regionName = "";
				if(country_select != null) {
					countryName = country_select.name;
					console.log("countryName: " + countryName)
				}
				
				if(area_select != null) {
					regionName = area_select.name;
					console.log("regionName: " + regionName)
				}
				
				
				
				location.replace("/board/list?sort=" + str + "&keyword=" + keyword + "&countrycode=" + countryName + "&regionname=" + regionName + "&pagenum=" + pagenum);
			}
		}

		else {			
			// 정렬 방법
			let sort = document.querySelector(".selected").value;
			console.log(sort);
			
			let str = "";
			if(sort == "최신 순") {
				str = "recent";
			}
			
			else if(sort == "인기 순") {
				str = "popular";
			}
			
			else {
				str = "like";
			}
			console.log(str);
			
			// 키워드
			let keyword = document.querySelector(".b_search").value;
			console.log(keyword);
			
			// 국가 코드 및 지역 이름
			const country_select = document.querySelector(".country_select");
			const area_select = document.querySelector(".area_select");
			console.log(country_select)
			console.log(area_select)
					
			let countryName = "";
			let regionName = "";
			if(country_select != null) {
				countryName = country_select.name;
				console.log("countryName: " + countryName)
			}
			
			if(area_select != null) {
				regionName = area_select.name;
				console.log("regionName: " + regionName)
			}
			
			
			
			location.replace("/board/list?sort=" + str + "&keyword=" + keyword + "&countrycode=" + countryName + "&regionname=" + regionName + "&pagenum=" + pagenum);
		}
		
	}

	

</script>
</html>